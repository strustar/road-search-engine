<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ AI-Powered Road Design Search</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --accent-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --success-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            --warning-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --dark-gradient: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            --glass-bg: rgba(255, 255, 255, 0.15);
            --glass-border: rgba(255, 255, 255, 0.3);
            --text-primary: #ffffff;
            --text-secondary: #c7d2fe;
            --text-muted: #94a3b8;
            --shadow-soft: 0 8px 32px rgba(0, 0, 0, 0.4);
            --shadow-medium: 0 16px 64px rgba(0, 0, 0, 0.5);
            --shadow-strong: 0 24px 96px rgba(0, 0, 0, 0.6);
            --border-radius-sm: 8px;
            --border-radius-md: 12px;
            --border-radius-lg: 16px;
            --border-radius-xl: 24px;
            --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-bounce: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--dark-gradient);
            color: var(--text-primary);
            min-height: 100vh;
            margin: 0;
            padding: 0;
            font-weight: 400;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
        }

        /* Î∞∞Í≤Ω Ïï†ÎãàÎ©îÏù¥ÏÖò */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.2) 0%, transparent 50%);
            animation: backgroundShift 20s ease-in-out infinite;
            z-index: -1;
        }

        @keyframes backgroundShift {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .app-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* ÏÉÅÎã® Ïª®Ìä∏Î°§ Î∞î */
        .top-control-bar {
            background: var(--glass-bg);
            border-bottom: 1px solid var(--glass-border);
            padding: 12px 20px;
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow-soft);
            z-index: 100;
            position: sticky;
            top: 0;
            border-radius: 0 0 var(--border-radius-lg) var(--border-radius-lg);
            margin: 0 12px;
            margin-top: 12px;
        }

        .control-sections {
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 24px;
            align-items: center;
            max-width: 1600px;
            margin: 0 auto;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .control-label {
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
            white-space: nowrap;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* ÎùºÎîîÏò§ Î≤ÑÌäº Ïä§ÌÉÄÏùº */
        .radio-group {
            display: flex;
            gap: 4px;
            background: var(--glass-bg);
            padding: 6px;
            border-radius: var(--border-radius-lg);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(10px);
        }

        .radio-option {
            padding: 12px 20px;
            border: none;
            border-radius: var(--border-radius-md);
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: var(--transition-smooth);
            white-space: nowrap;
            position: relative;
            overflow: hidden;
        }

        .radio-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--accent-gradient);
            opacity: 0;
            transition: var(--transition-smooth);
            z-index: -1;
        }

        .radio-option.active {
            color: var(--text-primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-soft);
        }

        .radio-option.active::before {
            opacity: 1;
        }

        .radio-option:hover:not(.active) {
            color: var(--text-primary);
            background: rgba(255, 255, 255, 0.05);
            transform: translateY(-1px);
        }

        /* Ïà´Ïûê ÏÑ†ÌÉù Î≤ÑÌäº */
        .number-selector {
            display: flex;
            gap: 4px;
            background: rgba(79, 209, 199, 0.1);
            padding: 3px;
            border-radius: 10px;
            border: 1px solid rgba(79, 209, 199, 0.3);
        }

        .number-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            background: transparent;
            color: #e2e8f0;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s ease;
            min-width: 32px;
        }

        .number-btn.active {
            background: linear-gradient(45deg, #4fd1c7, #06d6a0);
            color: white;
            box-shadow: 0 2px 6px rgba(79, 209, 199, 0.3);
        }

        .number-btn:hover:not(.active) {
            background: rgba(79, 209, 199, 0.15);
            color: #4fd1c7;
        }

        /* ÌÜ†Í∏Ä Ïä§ÏúÑÏπò */
        .toggle-switch {
            position: relative;
            width: 48px;
            height: 24px;
            background: rgba(79, 209, 199, 0.2);
            border-radius: 12px;
            border: 1px solid rgba(79, 209, 199, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-switch.active {
            background: linear-gradient(45deg, #4fd1c7, #06d6a0);
        }

        .toggle-knob {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 18px;
            height: 18px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .toggle-switch.active .toggle-knob {
            transform: translateX(24px);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            flex: 1;
            gap: 24px;
            height: calc(100vh - 120px);
            padding: 0 24px 24px 24px;
        }

        /* Ï¢åÏ∏° Í≤ÄÏÉâ Ìå®ÎÑê */
        .left-panel {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.05) 100%);
            color: var(--text-primary);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            padding: 24px;
            border-radius: var(--border-radius-xl);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow-medium);
            position: relative;
        }

        .left-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--primary-gradient);
            opacity: 0.08;
            border-radius: var(--border-radius-xl);
            z-index: -1;
        }

        .right-panel {
            background: var(--glass-bg);
            color: var(--text-primary);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border-radius: var(--border-radius-xl);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow-medium);
            position: relative;
            z-index: -1;
        }

        .right-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--secondary-gradient);
            opacity: 0.05;
            border-radius: var(--border-radius-xl);
            z-index: -1;
        }

        /* Ïä§ÌÅ¨Î°§ PDF Ïª®ÌÖåÏù¥ÎÑà Ïä§ÌÉÄÏùº */
        .scroll-pdf-container {
            height: calc(100% - 60px);
            background: #ffffff;
            overflow-y: auto;
            scroll-behavior: smooth;
        }

        .scroll-pdf-container::-webkit-scrollbar {
            width: 8px;
        }

        .scroll-pdf-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .scroll-pdf-container::-webkit-scrollbar-thumb {
            background: #4fd1c7;
            border-radius: 4px;
        }

        .scroll-pdf-container::-webkit-scrollbar-thumb:hover {
            background: #06d6a0;
        }

        .header {
            background: var(--glass-bg);
            padding: 24px 32px;
            text-align: center;
            border-bottom: 1px solid var(--glass-border);
            backdrop-filter: blur(20px);
            position: relative;
            box-shadow: var(--shadow-soft);
            border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
            margin-bottom: 24px;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--accent-gradient);
            opacity: 0.1;
            border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
            pointer-events: none;
        }

        .header h1 {
            font-size: 2.8rem;
            font-weight: 700;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 12px;
            letter-spacing: -0.02em;
            position: relative;
            z-index: 1;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            animation: titleGlow 3s ease-in-out infinite alternate;
        }

        @keyframes titleGlow {
            0% { filter: brightness(1); }
            100% { filter: brightness(1.2); }
        }

        /* Ï∂îÍ∞Ä Ïï†ÎãàÎ©îÏù¥ÏÖò Ìö®Í≥º */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* ÌéòÏù¥ÏßÄ Î°úÎìú Ïï†ÎãàÎ©îÏù¥ÏÖò */
        .app-container {
            animation: fadeInUp 0.8s ease-out;
        }

        .left-panel {
            animation: slideInLeft 0.6s ease-out 0.2s both;
        }

        .right-panel {
            animation: slideInRight 0.6s ease-out 0.4s both;
        }

        .result-item {
            animation: fadeInUp 0.5s ease-out;
        }

        /* Ìò∏Î≤Ñ Ìö®Í≥º Í∞ïÌôî */
        .stat-card:hover {
            animation: pulse 0.6s ease-in-out;
        }

        /* Ïä§ÌÅ¨Î°§Î∞î Ïä§ÌÉÄÏùºÎßÅ */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--glass-bg);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--accent-gradient);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-gradient);
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .stat-card {
            background: rgba(248, 250, 252, 0.1);
            padding: 12px 20px;
            border-radius: 20px;
            backdrop-filter: blur(16px);
            border: 2px solid rgba(79, 209, 199, 0.25);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            text-align: center;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(79, 209, 199, 0.12), rgba(6, 214, 160, 0.12));
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            border-color: rgba(79, 209, 199, 0.6);
            box-shadow: 0 12px 30px rgba(79, 209, 199, 0.25);
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .search-container {
            max-width: 900px;
            margin: 32px auto;
            padding: 0 24px;
        }

        .search-box {
            position: relative;
            margin-bottom: 24px;
        }


        .search-input {
            width: 100%;
            padding: 20px 80px 20px 28px;
            border: none;
            border-radius: var(--border-radius-xl);
            background: rgba(255, 255, 255, 0.18);
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 500;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: var(--transition-smooth);
            box-shadow: var(--shadow-soft);
            position: relative;
        }

        .search-input:focus {
            outline: none;
            border-color: rgba(79, 172, 254, 0.8);
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.15), var(--shadow-medium);
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        .search-input::placeholder {
            color: var(--text-muted);
            font-weight: 400;
        }

        .search-btn {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--accent-gradient);
            border: none;
            padding: 12px 20px;
            border-radius: var(--border-radius-lg);
            color: var(--text-primary);
            cursor: pointer;
            transition: var(--transition-bounce);
            font-size: 14px;
            font-weight: 600;
            box-shadow: var(--shadow-soft);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .search-btn:hover {
            transform: translateY(-50%) scale(1.05);
            box-shadow: var(--shadow-medium);
        }

        .search-btn:active {
            transform: translateY(-50%) scale(0.95);
        }

        /* Í≥†Í∏â ÏòµÏÖò Ïä§ÌÉÄÏùº */
        .search-options {
            margin-top: 16px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: var(--border-radius-lg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .advanced-options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            align-items: center;
        }

        .option-item {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            position: relative;
        }

        .checkbox-label input[type="checkbox"] {
            appearance: none;
            width: 18px;
            height: 18px;
            border: 2px solid var(--glass-border);
            border-radius: 4px;
            background: transparent;
            cursor: pointer;
            position: relative;
        }

        .checkbox-label input[type="checkbox"]:checked {
            background: var(--accent-gradient);
            border-color: transparent;
        }

        .checkbox-label input[type="checkbox"]:checked::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        .select-label {
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 500;
            white-space: nowrap;
        }

        .context-select {
            padding: 8px 12px;
            border-radius: var(--border-radius-md);
            border: 1px solid var(--glass-border);
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: var(--transition-smooth);
        }

        .context-select:focus {
            outline: none;
            border-color: rgba(79, 172, 254, 0.8);
            box-shadow: 0 0 0 2px rgba(79, 172, 254, 0.15);
        }

        .context-select option {
            background: rgba(0, 0, 0, 0.8);
            color: var(--text-primary);
        }

        /* Î∞òÍ≤Ω Î≤ÑÌäº Ïä§ÌÉÄÏùº */
        .radius-btn {
            padding: 6px 12px;
            border-radius: var(--border-radius-md);
            border: 1px solid rgba(79, 209, 199, 0.3);
            background: rgba(79, 209, 199, 0.1);
            color: #a0aec0;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition-smooth);
            white-space: nowrap;
        }

        .radius-btn:hover {
            background: rgba(79, 209, 199, 0.2);
            border-color: rgba(79, 209, 199, 0.5);
            color: #e2e8f0;
        }

        .radius-btn.active {
            background: rgba(79, 209, 199, 0.3);
            border-color: #4fd1c7;
            color: #4fd1c7;
            font-weight: 600;
        }

        /* Î¨∏ÏÑú ÌïÑÌÑ∞ ÏÑπÏÖò Ïä§ÌÉÄÏùº */
        .document-filter-section {
            margin-top: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: var(--border-radius-lg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .filter-header {
            margin-bottom: 16px;
        }

        .filter-label {
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 600;
        }

        .filter-options {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 10px 16px;
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius-md);
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition-smooth);
            backdrop-filter: blur(10px);
        }

        .filter-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(79, 172, 254, 0.5);
            transform: translateY(-2px);
        }

        .filter-btn.active {
            background: var(--accent-gradient);
            border-color: transparent;
            color: white;
            box-shadow: var(--shadow-soft);
        }

        /* ÌååÏùº Î™©Î°ù Ïª®ÌÖåÏù¥ÎÑà */
        .file-list-container {
            margin-top: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius-md);
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
        }

        .file-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.1);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .file-list-title {
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 600;
        }

        .close-file-list {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 16px;
            padding: 4px;
            border-radius: 4px;
            transition: var(--transition-smooth);
        }

        .close-file-list:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        .file-list {
            max-height: 300px;
            overflow-y: auto;
            padding: 8px;
        }

        .file-item {
            padding: 8px 12px;
            margin: 4px 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius-sm);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            font-size: 13px;
            cursor: pointer;
            transition: var(--transition-smooth);
        }

        .file-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(79, 172, 254, 0.3);
        }

        /* ÌïÑÌÑ∞ Ïª®ÌÖåÏù¥ÎÑà Ïä§ÌÉÄÏùº */
        .filter-container {
            position: relative;
            min-height: 60px; /* ÏµúÏÜå ÎÜíÏù¥ Í≥†Ï†ï */
        }

        /* Í≥†Ï†ï ÏúÑÏπò ÌååÏùº Î™©Î°ù Ïä§ÌÉÄÏùº */
        .fixed-file-list {
            position: absolute !important;
            top: 100% !important;
            left: 0 !important;
            right: 0 !important;
            background: rgba(255, 255, 255, 0.98) !important;
            border: 2px solid rgba(79, 172, 254, 0.4) !important;
            border-radius: var(--border-radius-md) !important;
            backdrop-filter: blur(10px) !important;
            overflow: visible !important;
            animation: slideInDown 0.3s ease-out !important;
            z-index: 9999999 !important;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4) !important;
            margin-top: 8px !important;
            padding: 16px !important;
        }

        .fixed-file-list .file-list-info {
            display: flex;
            justify-content: space-around;
            align-items: center;
            gap: 20px;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.05);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            flex-wrap: nowrap;
            white-space: nowrap;
            min-width: 0;
        }

        .fixed-file-list .info-item {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: nowrap;
            white-space: nowrap;
            flex: 1;
            justify-content: center;
        }

        .fixed-file-list .info-label {
            color: #666666;
            font-size: 13px;
            font-weight: 600;
            white-space: nowrap !important;
        }

        .fixed-file-list .info-value {
            color: #333333;
            font-size: 14px;
            font-weight: 700;
            white-space: nowrap !important;
        }

        .fixed-file-list .file-list-content {
            padding: 12px 16px;
            max-height: 160px; /* Ï†ïÌôïÌûà 5Í∞ú ÌååÏùº ÎÜíÏù¥ (32px * 5) */
            overflow-y: auto;
            overflow-x: hidden;
        }

        /* Ïä§ÌÅ¨Î°§Î∞î Ïä§ÌÉÄÏùºÎßÅ */
        .fixed-file-list .file-list-content::-webkit-scrollbar {
            width: 6px;
        }

        .fixed-file-list .file-list-content::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 3px;
        }

        .fixed-file-list .file-list-content::-webkit-scrollbar-thumb {
            background: rgba(79, 172, 254, 0.6);
            border-radius: 3px;
        }

        .fixed-file-list .file-list-content::-webkit-scrollbar-thumb:hover {
            background: rgba(79, 172, 254, 0.8);
        }

        .fixed-file-list .file-list-title {
            color: #333333;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .fixed-file-list .file-items {
            display: flex;
            flex-direction: column;
            gap: 6px;
            max-height: 150px;
            overflow-y: auto;
        }

        .fixed-file-list .file-item {
            padding: 8px 12px !important;
            background: rgba(255, 255, 255, 0.95) !important;
            border: 1px solid rgba(0, 0, 0, 0.15) !important;
            border-radius: var(--border-radius-sm) !important;
            color: #333333 !important;
            font-size: 13px !important;
            transition: var(--transition-smooth) !important;
            margin-bottom: 3px !important;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
            height: 32px !important; /* Ìïú Ï§ÑÎ°ú ÌëúÏãúÌïòÍ∏∞ ÏúÑÌïú ÎÜíÏù¥ */
            display: flex !important;
            flex-direction: row !important;
            align-items: center !important;
            justify-content: space-between !important;
            white-space: nowrap !important;
            overflow: hidden !important;
        }

        .fixed-file-list .file-item:hover {
            background: rgba(79, 172, 254, 0.1);
            border-color: rgba(79, 172, 254, 0.4);
            transform: translateY(-1px);
        }

        .fixed-file-list .file-item .file-name {
            font-weight: 700 !important;
            color: #1a1a1a !important;
            margin-bottom: 0 !important;
            font-size: 13px !important;
            line-height: 1.2 !important;
            white-space: nowrap !important;
            overflow: hidden !important;
            text-overflow: ellipsis !important;
            flex: 1 !important;
            margin-right: 8px !important;
        }

        .fixed-file-list .file-item .file-details {
            font-size: 11px !important;
            color: #555555 !important;
            opacity: 1 !important;
            font-weight: 500 !important;
            white-space: nowrap !important;
            overflow: hidden !important;
            text-overflow: ellipsis !important;
            line-height: 1.2 !important;
            flex-shrink: 0 !important;
        }

        .file-select-wrapper {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .file-select-label {
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .file-select {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius-md);
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition-smooth);
            backdrop-filter: blur(10px);
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23ffffff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 16px center;
            background-size: 16px;
            padding-right: 40px;
        }

        .file-select:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(79, 172, 254, 0.5);
        }

        .file-select:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(79, 172, 254, 0.7);
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .file-select option {
            background: #1a1a2e;
            color: var(--text-primary);
            padding: 8px;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideInUp {
            from { 
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            to { 
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes slideInDown {
            from { 
                opacity: 0;
                transform: translateY(-20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        .search-modes {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .mode-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.1);
            color: #e2e8f0;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .mode-btn.active {
            background: linear-gradient(45deg, #4fd1c7, #06d6a0);
            color: white;
        }

        .mode-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .loading {
            display: none;
            text-align: center;
            margin: 48px 0;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--glass-border);
            border-top: 4px solid transparent;
            border-radius: 50%;
            background: conic-gradient(from 0deg, var(--accent-gradient), transparent);
            animation: spin 1.2s linear infinite;
            margin: 0 auto 24px;
            position: relative;
        }

        .loading-spinner::before {
            content: '';
            position: absolute;
            top: 4px;
            left: 4px;
            right: 4px;
            bottom: 4px;
            background: var(--glass-bg);
            border-radius: 50%;
            backdrop-filter: blur(10px);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px;
        }

        .result-item {
            background: var(--glass-bg);
            margin: 16px 0;
            padding: 24px;
            border-radius: var(--border-radius-xl);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            transition: var(--transition-smooth);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .result-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--accent-gradient);
            opacity: 0;
            transition: var(--transition-smooth);
            z-index: -1;
        }

        .result-item:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-medium);
            border-color: rgba(79, 172, 254, 0.5);
        }

        .result-item:hover::before {
            opacity: 0.05;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
            gap: 16px;
        }

        .result-score {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--success-gradient);
            color: var(--text-primary);
            padding: 8px 16px;
            border-radius: var(--border-radius-lg);
            font-size: 14px;
            font-weight: 600;
            box-shadow: var(--shadow-soft);
            white-space: nowrap;
        }

        .result-content {
            font-size: 15px;
            line-height: 1.6;
            margin-bottom: 16px;
            color: var(--text-primary);
            font-weight: 400;
            background: rgba(255, 255, 255, 0.05);
            padding: 14px;
            border-radius: var(--border-radius-md);
            border-left: 4px solid rgba(79, 172, 254, 0.6);
        }

        .result-meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .meta-badge {
            background: var(--glass-bg);
            padding: 6px 10px;
            border-radius: var(--border-radius-md);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(10px);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
        }

        .meta-badge::before {
            content: '';
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent-gradient);
        }

        .result-actions {
            margin-top: 20px;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 10px 16px;
            border: none;
            border-radius: var(--border-radius-lg);
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: var(--transition-bounce);
            backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .pdf-btn {
            background: var(--primary-gradient);
            color: var(--text-primary);
            box-shadow: var(--shadow-soft);
        }

        .pdf-btn:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: var(--shadow-medium);
        }

        .highlight-btn {
            background: var(--warning-gradient);
            color: var(--text-primary);
            box-shadow: var(--shadow-soft);
        }

        .highlight-btn:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: var(--shadow-medium);
        }

        .highlight-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(20px);
        }

        .modal-content {
            background: var(--glass-bg);
            padding: 32px;
            border-radius: var(--border-radius-xl);
            max-width: 90%;
            max-height: 90%;
            overflow: auto;
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow-strong);
            border: 2px solid #4fd1c7;
        }

        .modal-content h3 {
            color: #4fd1c7;
            margin-bottom: 15px;
            text-align: center;
        }

        .modal-content img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .close {
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 30px;
            color: #4fd1c7;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #06d6a0;
        }

        /* ÌÖåÏù¥Î∏î Ïä§ÌÉÄÏùº Í∞úÏÑ† */
        .results-table {
            overflow-x: auto;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            border-radius: 16px;
            border: 1px solid rgba(148, 163, 184, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(16px);
            margin-top: 24px;
        }

        .results-table table {
            width: 100%;
            border-collapse: collapse;
            color: #f8fafc;
            font-size: 14px;
            font-weight: 400;
            line-height: 1.5;
        }

        .results-table th {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            padding: 16px 14px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid rgba(56, 189, 248, 0.6);
            border-right: 1px solid rgba(148, 163, 184, 0.2);
            color: #f8fafc;
            font-size: 14px;
            letter-spacing: 0.025em;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .results-table td {
            padding: 14px;
            border-bottom: 1px solid rgba(148, 163, 184, 0.15);
            border-right: 1px solid rgba(148, 163, 184, 0.15);
            vertical-align: top;
            transition: all 0.2s ease;
        }

        .results-table tr:hover {
            background-color: rgba(56, 189, 248, 0.08) !important;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(56, 189, 248, 0.15);
        }

        .score-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 14px;
            text-align: center;
            min-width: 50px;
        }

        .page-badge {
            background: #4fd1c7;
            color: #1a202c;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }

        /* Î™®Î∞îÏùº Î∞òÏùëÌòï */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr !important;
            }

            .right-panel {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .top-control-bar {
                padding: 12px 16px;
            }

            .control-sections {
                grid-template-columns: 1fr !important;
                gap: 16px;
            }

            .control-group {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .radio-group {
                width: 100%;
                justify-content: center;
            }

            .number-selector {
                width: 100%;
                justify-content: center;
            }

            .main-content {
                grid-template-columns: 1fr !important;
                height: calc(100vh - 140px) !important;
            }

            .left-panel {
                padding: 16px;
            }

            .results-table {
                font-size: 11px;
            }

            .results-table th,
            .results-table td {
                padding: 8px 6px;
            }

            .search-options {
                grid-template-columns: 1fr !important;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr) !important;
            }
        }

        @media (max-width: 480px) {
            .top-control-bar {
                padding: 8px 12px;
            }

            .radio-option, .number-btn {
                font-size: 11px;
                padding: 6px 12px;
            }

            .control-label {
                font-size: 11px;
            }

            .left-panel {
                padding: 12px;
            }

            .search-input {
                font-size: 14px;
                padding: 12px 16px;
            }

            .search-btn {
                padding: 10px 14px;
                font-size: 14px;
            }
        }

        /* Ïä§ÌÅ¨Î°§Î∞î Ïä§ÌÉÄÏùº */
        .results-table::-webkit-scrollbar {
            height: 10px;
        }

        .results-table::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.5);
            border-radius: 6px;
        }

        .results-table::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #38bdf8, #06b6d4);
            border-radius: 6px;
            border: 1px solid rgba(148, 163, 184, 0.2);
        }

        .results-table::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #0ea5e9, #0891b2);
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(56, 189, 248, 0.3);
            border-radius: 50%;
            border-top-color: #38bdf8;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Ï∂îÍ∞Ä Ïï†ÎãàÎ©îÏù¥ÏÖò Î∞è ÎßàÏù¥ÌÅ¨Î°úÏù∏ÌÑ∞ÎûôÏÖò */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .results-table tr {
            animation: fadeInUp 0.5s ease forwards;
        }

        .results-table tr:nth-child(even) {
            animation-delay: 0.1s;
        }

        .results-table tr:nth-child(odd) {
            animation-delay: 0.05s;
        }

        .header {
            animation: slideInLeft 0.8s ease forwards;
        }

        .search-container {
            animation: fadeInUp 0.6s ease forwards;
            animation-delay: 0.2s;
        }

        /* Ï†ëÍ∑ºÏÑ± Í∞úÏÑ† */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: #a0aec0;
            font-size: 18px;
        }

        .error-message {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        @media (max-width: 1200px) {
            .left-panel, .right-panel {
                width: 50%;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
                gap: 16px;
                padding: 0 16px 16px 16px;
            }

            .left-panel, .right-panel {
                width: 100%;
            }

            .left-panel {
                border-bottom: 1px solid var(--glass-border);
                border-right: none;
                padding: 24px;
            }

            .right-panel {
                border-left: none;
                min-height: 400px;
            }

            .header h1 {
                font-size: 2.2rem;
                letter-spacing: -0.01em;
            }

            .stats {
                gap: 15px;
            }

            .search-input {
                font-size: 16px;
                padding: 20px 60px 20px 24px;
                border-radius: var(--border-radius-lg);
            }

            .result-item {
                padding: 24px;
            }

            .viewer-container {
                padding: 16px;
            }

            .search-modes {
                flex-wrap: wrap;
                gap: 8px;
            }

            .mode-btn {
                padding: 10px 16px;
                font-size: 0.9rem;
            }

            .control-sections {
                grid-template-columns: 1fr;
                gap: 16px;
                text-align: center;
            }

            .top-control-bar {
                margin: 8px;
                padding: 12px 16px;
            }

            .advanced-options-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .option-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 15px;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .stats {
                flex-direction: column;
                gap: 10px;
            }

            .stat-card {
                padding: 8px 15px;
                font-size: 0.9rem;
            }

            .search-container {
                margin: 20px auto;
            }

            .viewer-container {
                padding: 10px;
            }

            .viewer-header h3 {
                font-size: 1.2rem;
            }
        }

        .pdf-viewer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            z-index: -1;
        }

        .pdf-viewer iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .close-pdf {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #ff4757;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            z-index: 1001;
            font-size: 16px;
        }

        .highlight {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #1a202c;
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: bold;
        }

        /* Î¨∏ÏÑú ÌïÑÌÑ∞ Ïä§ÌÉÄÏùº */
        .doc-filter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(79, 209, 199, 0.3);
        }

        .doc-filter-btn.active {
            background: linear-gradient(45deg, #4fd1c7, #06d6a0) !important;
            color: white !important;
            border: none !important;
        }

        .doc-item:hover {
            background: rgba(79, 209, 199, 0.1) !important;
            cursor: pointer;
        }

        .document-list::-webkit-scrollbar {
            width: 8px;
        }

        .document-list::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.5);
            border-radius: 4px;
        }

        .document-list::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #4fd1c7, #06d6a0);
            border-radius: 4px;
        }

        /* Ïö∞Ï∏° Ìå®ÎÑê Ïä§ÌÉÄÏùºÎßÅ */
        .viewer-container {
            padding: 32px;
            height: 100%;
            display: flex;
            flex-direction: column;
            background: linear-gradient(135deg, rgba(15, 20, 25, 0.8) 0%, rgba(30, 41, 59, 0.9) 100%);
            border-radius: 20px;
            margin: 16px;
            border: 1px solid rgba(79, 209, 199, 0.3);
            backdrop-filter: blur(20px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
            position: relative;
            overflow: hidden;
        }

        .viewer-header {
            margin-bottom: 24px;
            padding: 24px 28px;
            background: linear-gradient(135deg, rgba(15, 20, 25, 0.9) 0%, rgba(30, 41, 59, 0.8) 100%);
            border-radius: 20px;
            border: 2px solid rgba(79, 209, 199, 0.3);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(16px);
            position: relative;
            overflow: hidden;
            z-index: -1;
        }

        .viewer-header h3 {
            color: #f8fafc;
            margin: 0 0 12px 0;
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, #4fd1c7, #06d6a0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .viewer-header p {
            color: #e2e8f0;
            margin: 0;
            font-size: 1.1rem;
            font-weight: 500;
            opacity: 0.9;
        }

        .viewer-content {
            flex: 1;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 250, 252, 0.98) 100%);
            border: 2px solid rgba(79, 209, 199, 0.2);
            border-radius: 16px;
            overflow: auto;
            position: relative;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            z-index: -1;
        }

        .pdf-container {
            background: #ffffff;
            width: 100%;
            height: 100%;
        }

        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            min-height: 400px;
            color: #64748b;
            font-size: 1.2rem;
            font-weight: 500;
            text-align: center;
            padding: 40px;
        }

        .viewer-content img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0 auto;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .viewer-content iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 8px;
            background: #ffffff !important;
            background-color: #ffffff !important;
        }

        .pdf-iframe-container {
            background: #ffffff !important;
            background-color: #ffffff !important;
            padding: 10px;
            border-radius: 8px;
        }

        .pdf-embed-container {
            background: #ffffff !important;
            background-color: #ffffff !important;
            padding: 10px;
            border-radius: 8px;
        }

        .pdf-embed-container embed {
            background: #ffffff !important;
            background-color: #ffffff !important;
        }

        .pdf-image-container {
            background: #ffffff !important;
            background-color: #ffffff !important;
        }

        .pdf-image-container img {
            background: #ffffff !important;
            transition: transform 0.3s ease;
        }

        .result-preview {
            margin: 15px 0;
            text-align: center;
            background: #ffffff;
            padding: 10px;
            border-radius: 8px;
        }

        .result-preview img {
            max-width: 100%;
            height: auto;
            max-height: 300px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            background: #ffffff;
        }

        .unified-viewer-toolbar {
            display: flex;
            gap: 10px;
            align-items: center;
            padding: 10px;
            background: #f7fafc;
            border-bottom: 1px solid #e2e8f0;
            flex-wrap: wrap;
        }

        .unified-viewer-toolbar button {
            padding: 8px 12px;
            background: #4fd1c7;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }

        .unified-viewer-toolbar button:hover {
            background: #38b2ac;
            transform: translateY(-1px);
        }

        .unified-viewer-toolbar button:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: none;
        }

        .unified-pdf-container {
            scrollbar-width: thin;
            scrollbar-color: #4fd1c7 #f7fafc;
        }

        .unified-pdf-container::-webkit-scrollbar {
            width: 8px;
        }

        .unified-pdf-container::-webkit-scrollbar-track {
            background: #f7fafc;
        }

        .unified-pdf-container::-webkit-scrollbar-thumb {
            background: #4fd1c7;
            border-radius: 4px;
        }

        .page-navigation button {
            padding: 6px 12px;
            background: #4fd1c7;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .page-navigation button:hover:not(:disabled) {
            background: #38b2ac;
        }

        .page-navigation button:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
        }

        .viewer-toolbar {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            padding: 10px;
            background: #e2e8f0;
            border-radius: 8px;
            align-items: center;
        }

        .viewer-toolbar button {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            background: #4fd1c7;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .viewer-toolbar button:hover {
            background: #06d6a0;
            transform: translateY(-1px);
        }

        .viewer-info {
            font-size: 13px;
            color: #718096;
            margin-left: auto;
        }

        /* ÌÜµÌï© Ìó§Îçî Ïä§ÌÉÄÏùº */
        .unified-header {
            background: rgba(255, 255, 255, 0.08);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            padding: 24px 32px;
            margin: 0 16px;
            margin-top: 16px;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-soft);
        }

        .header-main {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .title-section {
            flex: 1;
        }

        .main-title {
            margin: 0;
            font-size: 32px;
            font-weight: 700;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .title-icon {
            font-size: 36px;
            filter: drop-shadow(0 2px 4px rgba(79, 172, 254, 0.3));
        }

        .subtitle {
            margin: 8px 0 0 0;
            color: var(--text-secondary);
            font-size: 16px;
            font-weight: 400;
            opacity: 0.9;
        }

        .status-badge {
            background: rgba(79, 172, 254, 0.1);
            border: 1px solid rgba(79, 172, 254, 0.3);
            border-radius: var(--border-radius-lg);
            padding: 12px 20px;
            backdrop-filter: blur(10px);
        }

        .badge-content {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .badge-label {
            color: var(--accent-gradient);
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .badge-value {
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 500;
        }

        /* ÌÜµÌï© Ïª®Ìä∏Î°§ ÏÑπÏÖò */
        .unified-controls {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius-md);
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow: visible;
        }

        .control-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 24px;
            align-items: start;
            align-content: start;
        }

        .control-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-height: 60px;
            justify-content: flex-start;
        }

        .control-label {
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        /* Î™®Îìú ÏÑ†ÌÉùÍ∏∞ */
        .mode-selector {
            display: flex;
            gap: 4px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius-md);
            padding: 4px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .mode-btn {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: var(--border-radius-sm);
            background: transparent;
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition-smooth);
        }

        .mode-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        .mode-btn.active {
            background: var(--accent-gradient);
            color: white;
            box-shadow: var(--shadow-soft);
        }

        /* Í∞úÏàò ÏÑ†ÌÉùÍ∏∞ */
        .count-selector {
            display: flex;
            gap: 4px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius-md);
            padding: 4px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .count-btn {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: var(--border-radius-sm);
            background: transparent;
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition-smooth);
        }

        .count-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        .count-btn.active {
            background: var(--success-gradient);
            color: white;
            box-shadow: var(--shadow-soft);
        }

        /* ÌïÑÌÑ∞ ÏÑ†ÌÉùÍ∏∞ */
        .filter-selector {
            display: flex;
            gap: 4px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius-md);
            padding: 4px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .filter-btn {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: var(--border-radius-sm);
            background: transparent;
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition-smooth);
            text-align: center;
        }

        .filter-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        .filter-btn.active {
            background: var(--warning-gradient);
            color: white;
            box-shadow: var(--shadow-soft);
        }

        /* ÎìúÎ°≠Îã§Ïö¥ Ïä§ÌÉÄÏùº */
        .filter-dropdown {
            position: relative;
        }

        .filter-select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius-md);
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition-smooth);
            backdrop-filter: blur(10px);
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23ffffff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
            padding-right: 40px;
        }

        .filter-select:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(79, 172, 254, 0.5);
        }

        .filter-select:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(79, 172, 254, 0.7);
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .filter-select option {
            background: #1a1a2e;
            color: var(--text-primary);
            padding: 8px;
        }

        /* Î∞òÏùëÌòï ÎîîÏûêÏù∏ */
        @media (max-width: 1200px) {
            .control-row {
                grid-template-columns: 1fr 1fr;
                gap: 16px;
            }
            
            .unified-header {
                padding: 20px 24px;
            }
            
            .main-title {
                font-size: 28px;
            }
        }

        @media (max-width: 900px) {
            .control-row {
                grid-template-columns: 1fr;
                gap: 12px;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 16px;
                align-items: flex-start;
            }
            
            .status-badge {
                align-self: flex-end;
            }
            
            .unified-header {
                padding: 16px 20px;
                margin: 0 12px;
                margin-top: 12px;
            }
            
            .main-title {
                font-size: 24px;
            }
            
            .subtitle {
                font-size: 14px;
            }
        }

        /* Í≤ÄÏÉâ ÌÜµÍ≥Ñ Ïä§ÌÉÄÏùº */
        .search-stats {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius-md);
            padding: 16px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 16px;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius-sm);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: var(--transition-smooth);
        }

        .stat-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
        }

        .stat-icon {
            font-size: 20px;
            opacity: 0.8;
        }

        .stat-content {
            flex: 1;
        }

        .stat-value {
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 12px;
            font-weight: 500;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }
            
            .stat-item {
                padding: 10px;
            }
            
            .stat-value {
                font-size: 14px;
            }
            
            .stat-label {
                font-size: 11px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- ÌÜµÌï© Ìó§Îçî -->
        <div class="unified-header">
            <div class="header-main">
                <div class="header-content">
                    <div class="title-section">
                        <h1 class="main-title">
                            <span class="title-icon">üîç</span>
                            ÎèÑÎ°úÏÑ§Í≥Ñ ÏßÄÎä•Ìòï Í≤ÄÏÉâ
                    </h1>
                        <p class="subtitle">ÌïúÍµ≠ÎèÑÎ°úÍ≥µÏÇ¨ ÏÑ§Í≥ÑÍ∏∞Ï§Ä | AI ÏùòÎØ∏Î°†Ï†Å Í≤ÄÏÉâ | Ïã§ÏãúÍ∞Ñ PDF Î∂ÑÏÑù</p>
                </div>
                    <div class="status-badge">
                        <div class="badge-content">
                            <span class="badge-label">ÏµúÏã† ÏóÖÎç∞Ïù¥Ìä∏</span>
                            <span class="badge-value">2024ÎÖÑ ÎèÑÎ°úÏÑ§Í≥ÑÍ∏∞Ï§Ä</span>
                    </div>
                </div>
            </div>

                <!-- ÌÜµÌï© Ïª®Ìä∏Î°§ ÏÑπÏÖò -->
                <div class="unified-controls">
                    <div class="control-row">
                        <div class="control-item">
                            <label class="control-label">üîç Í≤ÄÏÉâ Î™®Îìú</label>
                            <div class="mode-selector">
                                <button class="mode-btn" data-mode="hybrid" onclick="setSearchModeRadio('hybrid')">ÌïòÏù¥Î∏åÎ¶¨Îìú</button>
                                <button class="mode-btn" data-mode="vector" onclick="setSearchModeRadio('vector')">ÏùòÎØ∏</button>
                                <button class="mode-btn active" data-mode="keyword" onclick="setSearchModeRadio('keyword')">ÌÇ§ÏõåÎìú</button>
                    </div>
                </div>

                        <div class="control-item">
                            <label class="control-label">üìä Í≤∞Í≥º Í∞úÏàò</label>
                            <div class="count-selector">
                                <button class="count-btn" data-count="10" onclick="setResultCount(10)">10</button>
                                <button class="count-btn active" data-count="20" onclick="setResultCount(20)">20</button>
                                <button class="count-btn" data-count="30" onclick="setResultCount(30)">30</button>
                                <button class="count-btn" data-count="50" onclick="setResultCount(50)">50</button>
                                <button class="count-btn" data-count="100" onclick="setResultCount(100)">100</button>
                    </div>
                </div>

                        <div class="control-item">
                            <label class="control-label">üìÅ Î¨∏ÏÑú Î≤îÏúÑ</label>
                            <div class="filter-container">
                                <div class="filter-selector">
                                    <button class="filter-btn active" data-filter="all" onclick="setDocumentFilter('all')">üìã Ï†ÑÏ≤¥ (15Í∞ú ÌååÏùº)</button>
                                    <button class="filter-btn" data-filter="ÎèÑÎ°úÏÑ§Í≥ÑÏöîÎ†π" onclick="setDocumentFilter('ÎèÑÎ°úÏÑ§Í≥ÑÏöîÎ†π')">üõ£Ô∏è ÎèÑÎ°úÏÑ§Í≥ÑÏöîÎ†π(2020) (5Í∞ú ÌååÏùº)</button>
                                    <button class="filter-btn" data-filter="Ïã§Î¨¥ÏßÄÏπ®" onclick="setDocumentFilter('Ïã§Î¨¥ÏßÄÏπ®')">üìñ Ïã§Î¨¥ÏßÄÏπ®(2020) (10Í∞ú ÌååÏùº)</button>
                </div>

                                <!-- ÌååÏùº Î™©Î°ù ÌëúÏãú (Í≥†Ï†ï ÏúÑÏπò) -->
                                <div class="fixed-file-list" id="fixedFileList" style="display: none;">
                                    <div class="file-list-info">
                                        <div class="info-item">
                                            <span class="info-label">üìÑ ÌååÏùº Í∞úÏàò:</span>
                                            <span class="info-value" id="fixedFileCount">0Í∞ú</span>
                        </div>
                                        <div class="info-item">
                                            <span class="info-label">üìä Ï¥ù ÌéòÏù¥ÏßÄ:</span>
                                            <span class="info-value" id="fixedTotalPages">0ÌéòÏù¥ÏßÄ</span>
                    </div>
                                        <div class="info-item">
                                            <span class="info-label">üíæ Ï¥ù ÌÅ¨Í∏∞:</span>
                                            <span class="info-value" id="fixedTotalSize">0MB</span>
                </div>
            </div>

                                    <div class="file-list-content">
                                        <div class="file-list-title">üìÑ ÌååÏùº Î™©Î°ù</div>
                                        <div class="file-items" id="fixedFileItems">
                </div>
                </div>
                </div>
                </div>
            </div>
        </div>
                    </div>
                    </div>
                </div>


        <div class="main-content">
            <!-- Ï¢åÏ∏° Í≤ÄÏÉâ Ìå®ÎÑê -->
            <div class="left-panel">
                <div class="search-container">
                    <div class="search-box">
                        <input
                            type="text"
                            class="search-input"
                            placeholder="ÎèÑÎ°ú ÏÑ§Í≥ÑÏóê ÎåÄÌïú ÏßàÎ¨∏ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî... (Ïòà: ÎèÑÎ°ú ÏÑ§Í≥ÑÏÜçÎèÑ, Ï∞®Î°úÌè≠ Í∏∞Ï§Ä)"
                            id="searchInput"
                        >
                        <button class="search-btn" onclick="performSearch()">üîç Í≤ÄÏÉâ</button>
                    </div>
                    

                    <!-- Í≥†Í∏â Í≤ÄÏÉâ ÏòµÏÖò -->
                    <div class="search-options">
                        <div class="advanced-options-grid">
                            <div class="option-item">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="fullSentences" onchange="updateContextOptions()">
                                    <span class="checkmark"></span>
                                üéØ ÌÇ§ÏõåÎìú Î¨∏Ïû•Îßå ÌëúÏãú
                            </label>
                            </div>
                            <div class="option-item">
                                <label class="select-label">üìÑ Ï†ÑÌõÑ Î¨∏Îß•:</label>
                                <select id="sentenceContext" onchange="updateContextOptions()" class="context-select">
                                    <option value="0">ÏóÜÏùå</option>
                                    <option value="1" selected>1Î¨∏Ïû•</option>
                                    <option value="2">2Î¨∏Ïû•</option>
                                    <option value="3">3Î¨∏Ïû•</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- ÏÉàÎ°úÏö¥ Í≥†Í∏â Í≤ÄÏÉâ Îã®ÏúÑ ÏòµÏÖò -->
                        <div class="granularity-section" style="margin-top: 15px; padding: 15px; background: rgba(79, 209, 199, 0.1); border-radius: 12px; border: 1px solid rgba(79, 209, 199, 0.2);">
                            <div style="margin-bottom: 12px;">
                                <label style="font-weight: 600; color: #4fd1c7; font-size: 14px;">üî¨ Í≤ÄÏÉâ Îã®ÏúÑ (Granularity)</label>
                            </div>
                            <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                                <div style="display: flex; gap: 8px; align-items: center;">
                                    <input type="radio" id="granularitySentence" name="granularity" value="sentence" checked onchange="updateGranularityOptions()">
                                    <label for="granularitySentence" style="color: #e2e8f0; font-size: 13px;">üìù Î¨∏Ïû• Îã®ÏúÑ</label>
                                </div>
                                <div style="display: flex; gap: 8px; align-items: center;">
                                    <input type="radio" id="granularityChar" name="granularity" value="char" onchange="updateGranularityOptions()">
                                    <label for="granularityChar" style="color: #e2e8f0; font-size: 13px;">üî§ Í∏ÄÏûê Îã®ÏúÑ</label>
                                </div>
                            </div>
                            
                            <!-- Î∞òÍ≤Ω ÏÑ§Ï†ï ÏòµÏÖò -->
                            <div id="radiusOptions" style="margin-top: 12px; display: flex; gap: 10px; flex-wrap: wrap;">
                                <!-- Î¨∏Ïû• Îã®ÏúÑ ÏòµÏÖò (Í∏∞Î≥∏ ÌëúÏãú) -->
                                <div id="sentenceRadiusOptions" style="display: flex; gap: 8px; align-items: center;">
                                    <span style="color: #a0aec0; font-size: 12px;">Ï£ºÎ≥Ä:</span>
                                    <button class="radius-btn active" data-radius="1" onclick="setRadius(1)">1Î¨∏Ïû•</button>
                                    <button class="radius-btn" data-radius="2" onclick="setRadius(2)">2Î¨∏Ïû•</button>
                                    <button class="radius-btn" data-radius="3" onclick="setRadius(3)">3Î¨∏Ïû•</button>
                                </div>
                                
                                <!-- Í∏ÄÏûê Îã®ÏúÑ ÏòµÏÖò (Ïà®ÍπÄ) -->
                                <div id="charRadiusOptions" style="display: none; gap: 8px; align-items: center;">
                                    <span style="color: #a0aec0; font-size: 12px;">Ï£ºÎ≥Ä:</span>
                                    <button class="radius-btn" data-radius="30" onclick="setRadius(30)">30Ïûê</button>
                                    <button class="radius-btn active" data-radius="50" onclick="setRadius(50)">50Ïûê</button>
                                    <button class="radius-btn" data-radius="100" onclick="setRadius(100)">100Ïûê</button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <div class="loading" id="loading">
                    <div class="loading-spinner"></div>
                    <p>Í≤ÄÏÉâ Ï§ë... Ïû†ÏãúÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî</p>
                </div>

                <!-- Í≤ÄÏÉâ ÌÜµÍ≥Ñ -->
                <div class="search-stats" id="searchStats" style="display: none;">
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-icon">üìä</div>
                            <div class="stat-content">
                                <div class="stat-value" id="statResults">0</div>
                                <div class="stat-label">Í≤ÄÏÉâ Í≤∞Í≥º</div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-icon">‚è±Ô∏è</div>
                            <div class="stat-content">
                                <div class="stat-value" id="statTime">0ms</div>
                                <div class="stat-label">Í≤ÄÏÉâ ÏãúÍ∞Ñ</div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-icon">üîç</div>
                            <div class="stat-content">
                                <div class="stat-value" id="statMode">ÌÇ§ÏõåÎìú</div>
                                <div class="stat-label">Í≤ÄÏÉâ Î™®Îìú</div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-icon">üìÅ</div>
                            <div class="stat-content">
                                <div class="stat-value" id="statFilter">Ï†ÑÏ≤¥</div>
                                <div class="stat-label">Î¨∏ÏÑú Î≤îÏúÑ</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="results" id="results"></div>
            </div>

            <!-- Ïö∞Ï∏° Î≥¥Í∏∞ Ìå®ÎÑê -->
            <div class="right-panel">
                <div class="viewer-container">
                    <div class="viewer-header">
                        <h3>üìÑ Î¨∏ÏÑú Î≥¥Í∏∞</h3>
                        <p>PDF ÏõêÎ≥∏ ÎòêÎäî ÌïòÏù¥ÎùºÏù¥Ìä∏ Ïù¥ÎØ∏ÏßÄÍ∞Ä Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§</p>
                    </div>
                    <div class="viewer-content" id="viewerContent">
                        <div class="empty-state">
                            <div style="text-align: center; padding: 60px 20px; color: #718096;">
                                <div style="font-size: 4rem; margin-bottom: 20px;">üìñ</div>
                                <h3 style="color: #2d3748; margin-bottom: 10px;">Î¨∏ÏÑúÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî</h3>
                                <p>Í≤ÄÏÉâ Í≤∞Í≥ºÏóêÏÑú "ÏõêÎ≥∏ PDF Î≥¥Í∏∞" ÎòêÎäî "ÌïòÏù¥ÎùºÏù¥Ìä∏ Î≥¥Í∏∞"Î•º ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="pdf-viewer" id="pdfViewer">
        <button class="close-pdf" onclick="closePDF()">‚úñ Îã´Í∏∞</button>
        <iframe id="pdfFrame"></iframe>
    </div>

    <script>
        let currentSearchMode = 'keyword';
        let searchTimeout;
        let currentResultCount = 20;
        let currentDisplayMode = 'table';
        let previewEnabled = false;
        let isSearching = false;
        
        // API URL ÏÑ§Ï†ï (Î∞∞Ìè¨ ÌôòÍ≤ΩÏóê Îî∞Îùº ÏûêÎèô Î≥ÄÍ≤Ω)
        const API_BASE_URL = window.location.hostname === 'localhost' 
            ? 'http://localhost:8080' 
            : 'https://road-search-engine.onrender.com';
        let currentDocumentFilter = 'all';

        // ÏÉÅÎã® Ïª®Ìä∏Î°§ Ìï®ÏàòÎì§
        function setSearchModeRadio(mode) {
            currentSearchMode = mode;

            // ÎùºÎîîÏò§ Î≤ÑÌäº UI ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelectorAll('#searchModeRadio .radio-option').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`#searchModeRadio [data-mode="${mode}"]`).classList.add('active');

            // Í≤ÄÏÉâÏñ¥Í∞Ä ÏûàÏúºÎ©¥ Ï¶âÏãú Ïû¨Í≤ÄÏÉâ
            const query = document.getElementById('searchInput').value.trim();
            if (query.length >= 2) {
                performSearch();
            }
        }

        function setResultCount(count) {
            currentResultCount = count;

            // Ïà´Ïûê Î≤ÑÌäº UI ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelectorAll('#resultCountSelector .number-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`#resultCountSelector [data-count="${count}"]`).classList.add('active');

            // Í≤ÄÏÉâÏñ¥Í∞Ä ÏûàÏúºÎ©¥ Ï¶âÏãú Ïû¨Í≤ÄÏÉâ
            const query = document.getElementById('searchInput').value.trim();
            if (query.length >= 2) {
                performSearch();
            }
        }

        function setDisplayModeRadio(mode) {
            currentDisplayMode = mode;

            // ÎùºÎîîÏò§ Î≤ÑÌäº UI ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelectorAll('#displayModeRadio .radio-option').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`#displayModeRadio [data-mode="${mode}"]`).classList.add('active');

            // Í≤ÄÏÉâÏñ¥Í∞Ä ÏûàÏúºÎ©¥ Ï¶âÏãú Ïû¨Í≤ÄÏÉâ
            const query = document.getElementById('searchInput').value.trim();
            if (query.length >= 2) {
                performSearch();
            }
        }

        function togglePreviewSwitch() {
            previewEnabled = !previewEnabled;

            // ÌÜ†Í∏Ä Ïä§ÏúÑÏπò UI ÏóÖÎç∞Ïù¥Ìä∏
            const toggleSwitch = document.getElementById('previewToggle');
            if (previewEnabled) {
                toggleSwitch.classList.add('active');
            } else {
                toggleSwitch.classList.remove('active');
            }

            // Í≤ÄÏÉâÏñ¥Í∞Ä ÏûàÏúºÎ©¥ Ï¶âÏãú Ïû¨Í≤ÄÏÉâ
            const query = document.getElementById('searchInput').value.trim();
            if (query.length >= 2) {
                performSearch();
            }
        }

        function setDocumentFilterRadio(filter) {
            currentDocumentFilter = filter;

            // ÎùºÎîîÏò§ Î≤ÑÌäº UI ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelectorAll('#documentFilterRadio .radio-option').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`#documentFilterRadio [data-filter="${filter}"]`).classList.add('active');

            // Í≤ÄÏÉâÏñ¥Í∞Ä ÏûàÏúºÎ©¥ Ï¶âÏãú Ïû¨Í≤ÄÏÉâ
            const query = document.getElementById('searchInput').value.trim();
            if (query.length >= 2) {
                performSearch();
            }
        }

        // ÏÉàÎ°úÏö¥ Î¨∏ÏÑú ÌïÑÌÑ∞ Ìï®Ïàò
        function setDocumentFilter(filter) {
            currentDocumentFilter = filter;

            // ÌïÑÌÑ∞ Î≤ÑÌäº UI ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-filter="${filter}"]`).classList.add('active');

            // 'Ï†ÑÏ≤¥'Í∞Ä ÏïÑÎãå Í≤ΩÏö∞ Í≥†Ï†ï ÏúÑÏπò ÌååÏùº Î™©Î°ù ÌëúÏãú
            if (filter !== 'all') {
                showFixedFileList(filter);
            } else {
                hideFixedFileList();
            }

            // Í≤ÄÏÉâÏñ¥Í∞Ä ÏûàÏúºÎ©¥ Ï¶âÏãú Ïû¨Í≤ÄÏÉâ
            const query = document.getElementById('searchInput').value.trim();
            if (query.length >= 2) {
                performSearch();
            }
        }

        // Í≥†Ï†ï ÏúÑÏπò ÌååÏùº Î™©Î°ù ÌëúÏãú Ìï®Ïàò
        function showFixedFileList(category) {
            const fixedFileList = document.getElementById('fixedFileList');
            const fileCount = document.getElementById('fixedFileCount');
            const totalPages = document.getElementById('fixedTotalPages');
            const totalSize = document.getElementById('fixedTotalSize');
            const fileItems = document.getElementById('fixedFileItems');
            
            if (!fixedFileList) {
                console.error('fixedFileList ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§!');
                return;
            }
            
            // ÌååÏùº Î™©Î°ù Îç∞Ïù¥ÌÑ∞
            const fileData = {
                'ÎèÑÎ°úÏÑ§Í≥ÑÏöîÎ†π': [
                    { name: 'Ï†ú1Í∂å ÎèÑÎ°úÍ≥ÑÌöçÎ∞è Íµ¨Ï°∞.pdf', pages: 621, size: 22.4 },
                    { name: 'Ï†ú2Í∂å ÌÜ†Í≥µ Î∞è Î∞∞Ïàò.pdf', pages: 761, size: 54.5 },
                    { name: 'Ï†ú3Í∂å ÍµêÎüâ.pdf', pages: 947, size: 30.6 },
                    { name: 'Ï†ú4Í∂å ÌÑ∞ÎÑê.pdf', pages: 751, size: 28.9 },
                    { name: 'Ï†ú5Í∂å Ìè¨Ïû• ÎèÑÎ°úÏïàÏ†Ñ Î∂ÄÎåÄÏãúÏÑ§ Î∞è ÌôòÍ≤Ω.pdf', pages: 791, size: 0 }
                ],
                'Ïã§Î¨¥ÏßÄÏπ®': [
                    { name: '0-Í∞ÑÏßÄ -Ìé∏Ïßë.pdf', pages: 23, size: 0.2 },
                    { name: '1-Î™©Ï∞®.pdf', pages: 4, size: 0.2 },
                    { name: '2ÏÑ§Í≥ÑÌñâÏ†ï-327ok.pdf', pages: 223, size: 37.2 },
                    { name: '3 ÍµêÌÜµ Î∞è Í∏∞ÌïòÍµ¨Ï°∞-327ok.pdf', pages: 20, size: 13.2 },
                    { name: '4ÌÜ†Í≥µ Î∞è Î∞∞ÏàòÍ≥µ-Ìé∏ÏßëÏ§ë.pdf', pages: 66, size: 32.6 },
                    { name: '5Íµ¨Ï°∞Î¨ºÍ≥µ-Ìé∏ÏßëÏ§ë-ok.pdf', pages: 50, size: 10.6 },
                    { name: '6Ìè¨Ïû•Í≥µ-Ìé∏Ïßë.pdf', pages: 70, size: 23.1 },
                    { name: '7ÌÑ∞ÎÑêÍ≥µ-Ìé∏Ïßëok.pdf', pages: 43, size: 17.1 },
                    { name: '8 Î∂ÄÎåÄÍ≥µ -Ìé∏Ïßë.pdf', pages: 6, size: 6.0 },
                    { name: '9Í∏∞ÌÉÄ-Ìé∏Ïßë.pdf', pages: 52, size: 12.0 }
                ]
            };

            const files = fileData[category] || [];
            
            // ÌÜµÍ≥Ñ Ï†ïÎ≥¥ Í≥ÑÏÇ∞
            const totalFileCount = files.length;
            const totalPageCount = files.reduce((sum, file) => sum + file.pages, 0);
            const totalSizeCount = files.reduce((sum, file) => sum + file.size, 0);
            
            // ÌÜµÍ≥Ñ Ï†ïÎ≥¥ ÌëúÏãú
            fileCount.textContent = `${totalFileCount}Í∞ú`;
            totalPages.textContent = `${totalPageCount.toLocaleString()}ÌéòÏù¥ÏßÄ`;
            totalSize.textContent = `${totalSizeCount.toFixed(1)}MB`;
            
               // ÌååÏùº Î™©Î°ù ÏÉùÏÑ± (Î™®Îì† ÌååÏùº ÌëúÏãú, Ïä§ÌÅ¨Î°§ Í∞ÄÎä•)
               if (fileItems) {
                   fileItems.innerHTML = '';
                   files.forEach(file => {
                       const fileItem = document.createElement('div');
                       fileItem.className = 'file-item';
                       fileItem.innerHTML = `
                           <div class="file-name">${file.name}</div>
                           <div class="file-details">
                               üìÑ ${file.pages}ÌéòÏù¥ÏßÄ | üíæ ${file.size}MB
                           </div>
                       `;
                       fileItems.appendChild(fileItem);
                   });
               }

            // ÌååÏùº Î™©Î°ù Í∞ïÏ†ú ÌëúÏãú
            fixedFileList.style.display = 'block';
            fixedFileList.style.visibility = 'visible';
            fixedFileList.style.opacity = '1';
        }

        // Í≥†Ï†ï ÏúÑÏπò ÌååÏùº Î™©Î°ù Ïà®Í∏∞Í∏∞ Ìï®Ïàò
        function hideFixedFileList() {
            const fixedFileList = document.getElementById('fixedFileList');
            if (fixedFileList) {
                fixedFileList.style.display = 'none';
                fixedFileList.style.visibility = 'hidden';
                fixedFileList.style.opacity = '0';
            }
        }


        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', function() {
            // ÌïÑÌÑ∞ Î≤ÑÌäº Ï¥àÍ∏∞ ÏÉÅÌÉú ÏÑ§Ï†ï
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector('[data-filter="all"]').classList.add('active');
            
            // Îã§Î•∏ Í≥≥ ÌÅ¥Î¶≠ Ïãú ÌååÏùº Î™©Î°ù Îã´Í∏∞
            document.addEventListener('click', function(event) {
                const fixedFileList = document.getElementById('fixedFileList');
                const filterContainer = document.querySelector('.filter-container');
                
                // ÌååÏùº Î™©Î°ùÏù¥ ÌëúÏãúÎêòÏñ¥ ÏûàÍ≥†, ÌÅ¥Î¶≠Ìïú Í≥≥Ïù¥ ÌïÑÌÑ∞ Ïª®ÌÖåÏù¥ÎÑà Î∞ñÏù¥ÎùºÎ©¥
                if (fixedFileList && fixedFileList.style.display === 'block') {
                    if (!filterContainer.contains(event.target)) {
                        hideFixedFileList();
                    }
                }
            });
        });

        // ÏÉàÎ°úÏö¥ Î™®Îìú ÏÑ†ÌÉù Ìï®Ïàò
        function setSearchModeRadio(mode) {
            currentSearchMode = mode;
            
            // Î™®Îì† Î™®Îìú Î≤ÑÌäºÏóêÏÑú active ÌÅ¥ÎûòÏä§ Ï†úÍ±∞
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // ÏÑ†ÌÉùÎêú Î™®Îìú Î≤ÑÌäºÏóê active ÌÅ¥ÎûòÏä§ Ï∂îÍ∞Ä
            document.querySelector(`[data-mode="${mode}"]`).classList.add('active');
            
            // Í≤ÄÏÉâÏñ¥Í∞Ä ÏûàÏúºÎ©¥ Ï¶âÏãú Ïû¨Í≤ÄÏÉâ
            const query = document.getElementById('searchInput').value.trim();
            if (query.length >= 2) {
                performSearch();
            }
        }

        // ÏÉàÎ°úÏö¥ Í≤∞Í≥º Í∞úÏàò ÏÑ§Ï†ï Ìï®Ïàò
        function setResultCount(count) {
            currentResultCount = count;  // currentMaxResults ÎåÄÏã† currentResultCount ÏÇ¨Ïö©
            
            // Î™®Îì† Í∞úÏàò Î≤ÑÌäºÏóêÏÑú active ÌÅ¥ÎûòÏä§ Ï†úÍ±∞
            document.querySelectorAll('.count-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // ÏÑ†ÌÉùÎêú Í∞úÏàò Î≤ÑÌäºÏóê active ÌÅ¥ÎûòÏä§ Ï∂îÍ∞Ä
            document.querySelector(`[data-count="${count}"]`).classList.add('active');
            
            // Í≤ÄÏÉâÏñ¥Í∞Ä ÏûàÏúºÎ©¥ Ï¶âÏãú Ïû¨Í≤ÄÏÉâ
            const query = document.getElementById('searchInput').value.trim();
            if (query.length >= 2) {
                performSearch();
            }
        }

        // Í≤ÄÏÉâ ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò
        function updateSearchStats(results, searchTime, mode, filter) {
            const statsContainer = document.getElementById('searchStats');
            const statResults = document.getElementById('statResults');
            const statTime = document.getElementById('statTime');
            const statMode = document.getElementById('statMode');
            const statFilter = document.getElementById('statFilter');
            
            if (results && results.length > 0) {
                statResults.textContent = results.length;
                statTime.textContent = `${searchTime}ms`;
                
                // Î™®ÎìúÎ™Ö Î≥ÄÌôò
                const modeNames = {
                    'hybrid': 'ÌïòÏù¥Î∏åÎ¶¨Îìú',
                    'vector': 'ÏùòÎØ∏',
                    'keyword': 'ÌÇ§ÏõåÎìú'
                };
                statMode.textContent = modeNames[mode] || mode;
                
                // ÌïÑÌÑ∞Î™Ö Î≥ÄÌôò
                const filterNames = {
                    'all': 'Ï†ÑÏ≤¥',
                    'ÎèÑÎ°úÏÑ§Í≥ÑÏöîÎ†π': 'ÎèÑÎ°úÏÑ§Í≥ÑÏöîÎ†π(2020)',
                    'Ïã§Î¨¥ÏßÄÏπ®': 'Ïã§Î¨¥ÏßÄÏπ®(2020)'
                };
                statFilter.textContent = filterNames[filter] || filter;
                
                statsContainer.style.display = 'block';
            } else {
                statsContainer.style.display = 'none';
            }
        }

        function setSearchMode(mode) {
            currentSearchMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-mode="${mode}"]`).classList.add('active');

            // Í≤ÄÏÉâ Î™®Îìú Î≥ÄÍ≤Ω Ïãú ÌòÑÏû¨ ÏøºÎ¶¨Í∞Ä ÏûàÏúºÎ©¥ Îã§Ïãú Í≤ÄÏÉâ
            const query = document.getElementById('searchInput').value.trim();
            if (query.length >= 2) {
                performSearch();
            }
        }

        // ÎØ∏Î¶¨Î≥¥Í∏∞ ÌÜ†Í∏Ä Ìï®Ïàò
        function togglePreview() {
            const query = document.getElementById('searchInput').value.trim();
            if (query.length >= 2) {
                performSearch(); // ÎØ∏Î¶¨Î≥¥Í∏∞ ÏÑ§Ï†ï Î≥ÄÍ≤Ω Ïãú Îã§Ïãú Í≤ÄÏÉâÌïòÏó¨ Í≤∞Í≥º ÏóÖÎç∞Ïù¥Ìä∏
            }
        }

        // Î¨∏Îß• ÌëúÏãú ÏòµÏÖò ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò
        function updateContextOptions() {
            const query = document.getElementById('searchInput').value.trim();
            if (query.length >= 2) {
                performSearch(); // Î¨∏Îß• ÏòµÏÖò Î≥ÄÍ≤Ω Ïãú Îã§Ïãú Í≤ÄÏÉâÌïòÏó¨ Í≤∞Í≥º ÏóÖÎç∞Ïù¥Ìä∏
            }
        }

        // Granularity ÏòµÏÖò ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò
        function updateGranularityOptions() {
            const granularity = document.querySelector('input[name="granularity"]:checked').value;
            const sentenceOptions = document.getElementById('sentenceRadiusOptions');
            const charOptions = document.getElementById('charRadiusOptions');
            
            if (granularity === 'sentence') {
                sentenceOptions.style.display = 'flex';
                charOptions.style.display = 'none';
                // Î¨∏Ïû• Îã®ÏúÑ Í∏∞Î≥∏Í∞íÏúºÎ°ú 1Î¨∏Ïû• ÏÑ§Ï†ï
                setRadius(1);
            } else {
                sentenceOptions.style.display = 'none';
                charOptions.style.display = 'flex';
                // Í∏ÄÏûê Îã®ÏúÑ Í∏∞Î≥∏Í∞íÏúºÎ°ú 50Ïûê ÏÑ§Ï†ï
                setRadius(50);
            }
            
            // Í≤ÄÏÉâÏñ¥Í∞Ä ÏûàÏúºÎ©¥ Îã§Ïãú Í≤ÄÏÉâ
            const query = document.getElementById('searchInput').value.trim();
            if (query.length >= 2) {
                performSearch();
            }
        }

        // Î∞òÍ≤Ω ÏÑ§Ï†ï Ìï®Ïàò
        function setRadius(radius) {
            // Î™®Îì† radius Î≤ÑÌäºÏóêÏÑú active ÌÅ¥ÎûòÏä§ Ï†úÍ±∞
            document.querySelectorAll('.radius-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // ÏÑ†ÌÉùÎêú Î≤ÑÌäºÏóê active ÌÅ¥ÎûòÏä§ Ï∂îÍ∞Ä
            document.querySelector(`[data-radius="${radius}"]`).classList.add('active');
            
            // Í≤ÄÏÉâÏñ¥Í∞Ä ÏûàÏúºÎ©¥ Îã§Ïãú Í≤ÄÏÉâ
            const query = document.getElementById('searchInput').value.trim();
            if (query.length >= 2) {
                performSearch();
            }
        }

        // ÌëúÏãú ÌòïÌÉú ÌÜ†Í∏Ä Ìï®Ïàò
        function toggleDisplayMode() {
            const query = document.getElementById('searchInput').value.trim();
            if (query.length >= 2) {
                performSearch(); // ÌëúÏãú ÌòïÌÉú Î≥ÄÍ≤Ω Ïãú Îã§Ïãú Í≤ÄÏÉâÌïòÏó¨ Í≤∞Í≥º ÏóÖÎç∞Ïù¥Ìä∏
            }
        }

        // Ïù¥ÎØ∏ÏßÄ ÌëúÏãú ÏòµÏÖò Ï†úÍ±∞Îê®
        function updateImageOptions() {
            // Ìï®Ïàò ÎπÑÌôúÏÑ±Ìôî
        }

        // Ïã§ÏãúÍ∞Ñ Í≤ÄÏÉâ Í∏∞Îä•
        function handleRealTimeSearch() {
            const query = document.getElementById('searchInput').value.trim();

            // Í≤ÄÏÉâÏñ¥Í∞Ä 2Í∏ÄÏûê ÎØ∏ÎßåÏù¥Î©¥ Í≤∞Í≥º Ï¥àÍ∏∞Ìôî
            if (query.length < 2) {
                document.getElementById('results').innerHTML = '';
                return;
            }

            // Ïù¥Ï†Ñ ÌÉÄÏù¥Î®∏ Ï∑®ÏÜå
            clearTimeout(searchTimeout);

            // 300ms ÌõÑÏóê Í≤ÄÏÉâ Ïã§Ìñâ (ÎîîÎ∞îÏö¥Ïã±)
            searchTimeout = setTimeout(() => {
                if (!isSearching) {
                    performSearch();
                }
            }, 300);
        }


        function performSearch() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) {
                return;
            }

            // 2Í∏ÄÏûê ÎØ∏ÎßåÏù¥Î©¥ Í≤ÄÏÉâÌïòÏßÄ ÏïäÏùå
            if (query.length < 2) {
                document.getElementById('results').innerHTML = '';
                return;
            }

            // Í≤ÄÏÉâ Ï§ë ÌîåÎûòÍ∑∏ ÏÑ§Ï†ï
            isSearching = true;


            const loading = document.getElementById('loading');
            const results = document.getElementById('results');

            loading.style.display = 'block';
            results.innerHTML = '';

            fetch(`${API_BASE_URL}/api/search`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    query: query,
                    mode: currentSearchMode,
                    max_results: currentResultCount,
                    full_sentences: document.getElementById('fullSentences').checked,
                    sentence_context: parseInt(document.getElementById('sentenceContext').value),
                    document_filter: currentDocumentFilter, // Î¨∏ÏÑú ÌïÑÌÑ∞ Ï∂îÍ∞Ä
                    // Í≥†Í∏â Í≤ÄÏÉâ ÌååÎùºÎØ∏ÌÑ∞ Ï∂îÍ∞Ä
                    granularity: document.querySelector('input[name="granularity"]:checked').value,
                    radius: parseInt(document.querySelector('.radius-btn.active').getAttribute('data-radius'))
                })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(async data => {
                loading.style.display = 'none';
                isSearching = false;

                // Í≤ÄÏÉâ ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
                const searchTime = data.search_time || 0;
                updateSearchStats(data.results, searchTime, currentSearchMode, currentDocumentFilter);

                // Ïù¥ÎØ∏ÏßÄ ÌëúÏãú ÏòµÏÖò Ï†úÍ±∞Îê®

                displayResults(data, query);
            })
            .catch(error => {
                loading.style.display = 'none';
                isSearching = false;
                console.error('Í≤ÄÏÉâ Ïò§Î•ò:', error);
                results.innerHTML = `
                    <div class="error-message">
                        ‚ùå Í≤ÄÏÉâ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ${error.message}
                        <br>FastAPI ÏÑúÎ≤Ñ(${API_BASE_URL})Í∞Ä Ïã§Ìñâ Ï§ëÏù∏ÏßÄ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.
                    </div>
                `;
            });
        }

        // Í≤ÄÏÉâ Í≤∞Í≥ºÏóê ÎåÄÌïú Ïù¥ÎØ∏ÏßÄ Î°úÎìú Ìï®Ïàò
        async function loadResultImages(data, query) {
            const cropImages = document.getElementById('cropImages').checked;
            const keywords = query.split(' ').filter(word => word.length > 1); // 1Í∏ÄÏûê Ï†úÏô∏


            // Í∞Å Í≤∞Í≥ºÏóê ÎåÄÌï¥ Ïù¥ÎØ∏ÏßÄ Î°úÎìú (Î≥ëÎ†¨ Ï≤òÎ¶¨)
            const imagePromises = data.results.map(async (result, index) => {
                try {
                    // ÌååÏùºÎ™ÖÏóêÏÑú ÏÉÅÎåÄ Í≤ΩÎ°ú Íµ¨ÏÑ± (Ìè¥Îçî Ìè¨Ìï®)
                    let fileName = result.metadata.file_name;

                    // ÌååÏùºÎ™ÖÏù¥ Ìè¥Îçî Í≤ΩÎ°úÎ•º Ìè¨Ìï®ÌïòÏßÄ ÏïäÏúºÎ©¥ Ìè¥ÎçîÎ™Ö Ï∂îÍ∞Ä
                    if (!fileName.includes('/') && !fileName.includes('\\')) {
                        // Ïã§Î¨¥ÏßÄÏπ® ÌååÏùºÎì§Í≥º ÎèÑÎ°úÏÑ§Í≥ÑÏöîÎ†π ÌååÏùºÎì§ Íµ¨Î∂Ñ
                        if (fileName.includes('Ïã§Î¨¥ÏßÄÏπ®')) {
                            fileName = 'Ïã§Î¨¥ÏßÄÏπ®(2020)/' + fileName;
                        } else {
                            fileName = 'ÎèÑÎ°úÏÑ§Í≥ÑÏöîÎ†π(2020)/' + fileName;
                        }
                    }

                    const pageNum = result.metadata.page - 1; // 0Î∂ÄÌÑ∞ ÏãúÏûë


                    const response = await fetch(`${API_BASE_URL}/api/render-page`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            file_path: fileName,
                            page_num: pageNum,
                            keywords: keywords,
                            crop_to_keywords: cropImages,
                            highlight_color: 'rgba(255, 255, 0, 128)'
                        })
                    });

                    if (response.ok) {
                        const imageData = await response.json();
                        if (imageData.success) {
                            result.image_b64 = imageData.image_b64;
                        } else {
                            console.warn(`Ïù¥ÎØ∏ÏßÄ ÏÉùÏÑ± Ïã§Ìå® [${index}]: ${imageData.message}`);
                        }
                    } else {
                        console.warn(`Ïù¥ÎØ∏ÏßÄ API Ïò§Î•ò [${index}]: ${response.status}`);
                    }
                } catch (error) {
                    console.error(`Ïù¥ÎØ∏ÏßÄ Î°úÎìú Ïò§Î•ò [${index}]:`, error);
                }
            });

            // Î™®Îì† Ïù¥ÎØ∏ÏßÄ Î°úÎìú ÏôÑÎ£å ÎåÄÍ∏∞
            await Promise.all(imagePromises);
        }

        function displayResults(data, query) {
            const results = document.getElementById('results');
            const displayMode = currentDisplayMode;

            if (!data.results || data.results.length === 0) {
                
                results.innerHTML = `
                    <div class="no-results">
                        üîç Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§.<br>
                        Îã§Î•∏ ÌÇ§ÏõåÎìúÎ°ú Í≤ÄÏÉâÌï¥Î≥¥ÏÑ∏Ïöî.
                    </div>
                `;
                return;
            }

            const searchMode = data.search_mode || 'hybrid';

            if (displayMode === 'table') {
                displayTableResults(data, query);
            } else {
                displayCardResults(data, query);
            }
        }

        function displayTableResults(data, query) {
            const results = document.getElementById('results');
            const searchMode = data.search_mode || 'hybrid';

            let html = `
                <div style="margin-bottom: 20px; padding: 20px; background: linear-gradient(135deg, rgba(15, 20, 25, 0.9) 0%, rgba(30, 41, 59, 0.8) 100%); border-radius: 16px; border: 1px solid rgba(79, 209, 199, 0.3);">
                    <h2 style="color: #4fd1c7; margin: 0 0 12px 0; text-align: center;">üìä Í≤ÄÏÉâ Í≤∞Í≥º</h2>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; margin-bottom: 12px;">
                        <div style="text-align: center; padding: 8px; background: rgba(79, 209, 199, 0.1); border-radius: 8px;">
                            <div style="font-size: 18px; font-weight: bold; color: #4fd1c7;">${data.results.length}</div>
                            <div style="font-size: 12px; color: #a0aec0;">Í≤ÄÏÉâ Í≤∞Í≥º</div>
                        </div>
                        <div style="text-align: center; padding: 8px; background: rgba(79, 209, 199, 0.1); border-radius: 8px;">
                            <div style="font-size: 14px; font-weight: bold; color: #4fd1c7;">${searchMode.toUpperCase()}</div>
                            <div style="font-size: 12px; color: #a0aec0;">Í≤ÄÏÉâ Î™®Îìú</div>
                        </div>
                        <div style="text-align: center; padding: 8px; background: rgba(79, 209, 199, 0.1); border-radius: 8px;">
                            <div style="font-size: 14px; font-weight: bold; color: #4fd1c7;">${currentDocumentFilter === 'all' ? 'Ï†ÑÏ≤¥' : currentDocumentFilter}</div>
                            <div style="font-size: 12px; color: #a0aec0;">Î¨∏ÏÑú ÌïÑÌÑ∞</div>
                        </div>
                        <div style="text-align: center; padding: 8px; background: rgba(79, 209, 199, 0.1); border-radius: 8px;">
                            <div style="font-size: 14px; font-weight: bold; color: #4fd1c7;">${data.search_time ? Math.round(data.search_time * 1000) + 'ms' : '< 100ms'}</div>
                            <div style="font-size: 12px; color: #a0aec0;">Í≤ÄÏÉâ ÏãúÍ∞Ñ</div>
                        </div>
                    </div>

                    <div style="text-align: center; color: #a0aec0; font-size: 13px;">
                        üí° ${data.total_documents || '6,139'}Í∞ú Î¨∏ÏÑú Ï≤≠ÌÅ¨ÏóêÏÑú Í≤ÄÏÉâ ÏôÑÎ£å
                    </div>
                </div>

                <div class="results-table">
                    <table>
                        <thead>
                            <tr style="background: #4a5568; border-bottom: 2px solid #4fd1c7;">
                                <th style="padding: 12px 8px; text-align: center; font-size: 13px; white-space: nowrap; border-right: 1px solid #2d3748; width: 50px;">#</th>
                                <th style="padding: 12px 8px; text-align: left; font-size: 13px; white-space: nowrap; border-right: 1px solid #2d3748;">üìà Ï†êÏàò</th>
                                <th style="padding: 12px 8px; text-align: left; font-size: 13px; white-space: nowrap; border-right: 1px solid #2d3748;">üéØ ÌÇ§ÏõåÎìú Ï†êÏàò</th>
                                <th style="padding: 12px 8px; text-align: left; font-size: 13px; white-space: nowrap; border-right: 1px solid #2d3748;">üìÅ Ï∂úÏ≤ò</th>
                                <th style="padding: 12px 8px; text-align: left; font-size: 13px; white-space: nowrap; border-right: 1px solid #2d3748;">üìë ÌéòÏù¥ÏßÄ</th>
                                <th style="padding: 12px 8px; text-align: left; font-size: 13px; width: 50%;">üìù Ï∂îÏ∂úÎêú ÎÇ¥Ïö©</th>
                                <th style="padding: 12px 8px; text-align: center; font-size: 13px; white-space: nowrap;">üîß ÏûëÏóÖ</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            data.results.forEach((result, index) => {
                const content = result.document || '';
                const highlightedContent = highlightKeywords(content, query);
                const score = result.score ? (result.score * 100).toFixed(1) : '0.0';
                const fileName = result.metadata ? result.metadata.file_name : 'Unknown';
                const pageZeroBased = result.metadata ? result.metadata.page : 0;
                const pageOneBased = pageZeroBased + 1;
                const pageLabel = result.metadata ? result.metadata.page_label : pageOneBased;
                const category = result.metadata ? result.metadata.category : 'Unknown';
                const folderName = category === 'Ïã§Î¨¥ÏßÄÏπ®' ? 'Ïã§Î¨¥ÏßÄÏπ®(2020)' : 'ÎèÑÎ°úÏÑ§Í≥ÑÏöîÎ†π(2020)';
                const fullPath = `${folderName}/${fileName}`;

                // ÌÇ§ÏõåÎìú Í≤ÄÏÉâ ÏµúÏ†ÅÌôî: 3Ï§Ñ Í∏∞Î≥∏, Ïä§ÎßàÌä∏ ÏöîÏïΩ
                let summary = content;
                const fullSentences = document.getElementById('fullSentences').checked;
                const sentenceContext = parseInt(document.getElementById('sentenceContext').value);

                if (fullSentences || currentSearchMode === 'keyword') {
                    // ÌÇ§ÏõåÎìú Ìè¨Ìï® Î¨∏Ïû• Ï§ëÏã¨ÏúºÎ°ú ÏµúÏ†ÅÌôîÎêú ÏöîÏïΩ
                    const sentences = content.split(/[.!?]/).filter(s => s.trim().length > 10);
                    const keywordSentences = sentences.filter(s =>
                        query.split(' ').some(keyword =>
                            s.toLowerCase().includes(keyword.toLowerCase())
                        )
                    );

                    if (keywordSentences.length > 0) {
                        // ÌÇ§ÏõåÎìú Ìè¨Ìï® Î¨∏Ïû• + Ï†ÑÌõÑ Î¨∏Îß•
                        const contextSentences = [];
                        keywordSentences.slice(0, 1).forEach(keywordSent => {
                            const index = sentences.indexOf(keywordSent);
                            const start = Math.max(0, index - sentenceContext);
                            const end = Math.min(sentences.length, index + sentenceContext + 1);
                            contextSentences.push(...sentences.slice(start, end));
                        });
                        summary = [...new Set(contextSentences)].join('. ').trim();
                    }
                }

                // ÏµúÎåÄ 200ÏûêÎ°ú Ï†úÌïú (ÌÖåÏù¥Î∏î Í∞ÄÎèÖÏÑ±ÏùÑ ÏúÑÌï¥)
                if (summary.length > 200) {
                    summary = summary.substring(0, 200) + '...';
                }

                const highlightedSummary = highlightKeywords(summary, query);

                // Ï†êÏàòÏóê Îî∞Î•∏ ÏÉâÏÉÅ
                const scoreColor = score >= 80 ? '#10b981' : score >= 60 ? '#f59e0b' : '#6b7280';

                // ÌÇ§ÏõåÎìú Ï†êÏàò Ï≤òÎ¶¨
                const keywordScore = result.keyword_score || null;
                const keywordScoreDisplay = keywordScore !== null ? `${keywordScore}%` : '-';
                const keywordScoreColor = keywordScore >= 80 ? '#10b981' : keywordScore >= 60 ? '#f59e0b' : keywordScore >= 40 ? '#f97316' : '#6b7280';
                
                // Ï∂îÏ∂úÎêú ÌÖçÏä§Ìä∏ ÏÇ¨Ïö© (extracted_textÍ∞Ä ÏûàÏúºÎ©¥ ÏÇ¨Ïö©, ÏóÜÏúºÎ©¥ Í∏∞Ï°¥ content ÏÇ¨Ïö©)
                const displayContent = result.extracted_text || content;
                const highlightedDisplayContent = highlightKeywords(displayContent, query);

                html += `
                    <tr style="border-bottom: 1px solid #4a5568; transition: background-color 0.2s;"
                        onmouseover="this.style.backgroundColor='#374151'"
                        onmouseout="this.style.backgroundColor='transparent'">
                        <td style="padding: 10px 8px; text-align: center; border-right: 1px solid #4a5568;">
                            <div style="color: #4fd1c7; font-weight: bold; font-size: 14px;">${index + 1}</div>
                        </td>
                        <td style="padding: 10px 8px; text-align: center; border-right: 1px solid #4a5568;">
                            <div class="score-badge" style="color: ${scoreColor};">${score}%</div>
                        </td>
                        <td style="padding: 10px 8px; text-align: center; border-right: 1px solid #4a5568;">
                            <div style="color: ${keywordScoreColor}; font-weight: 600; font-size: 12px;">${keywordScoreDisplay}</div>
                        </td>
                        <td style="padding: 10px 8px; border-right: 1px solid #4a5568; max-width: 200px;">
                            <div style="font-size: 12px; color: #4fd1c7; font-weight: 500; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${fullPath}">
                                ${fullPath}
                            </div>
                        </td>
                        <td style="padding: 10px 8px; text-align: center; border-right: 1px solid #4a5568;">
                            <div class="page-badge">${pageLabel}</div>
                        </td>
                        <td style="padding: 10px 8px; line-height: 1.4; font-size: 13px; border-right: 1px solid #4a5568;">
                            <div style="white-space: pre-wrap; word-wrap: break-word; max-height: 300px; overflow-y: auto;">
                                ${highlightedDisplayContent}
                            </div>
                        </td>
                        <td style="padding: 10px 8px; text-align: center;">
                            <div style="display: flex; gap: 4px; justify-content: center; flex-wrap: wrap;">
                                <button onclick="openPDF('${fullPath}', ${pageOneBased}, '${category}')"
                                        style="background: #3182ce; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 11px; cursor: pointer; transition: background 0.2s;"
                                        onmouseover="this.style.backgroundColor='#2c5aa0'"
                                        onmouseout="this.style.backgroundColor='#3182ce'">
                                    üìÑ ÏõêÎ≥∏
                                </button>
                                <button onclick="showHighlightedPage('${fullPath}', ${pageOneBased}, '${query}', '${category}')"
                                        style="background: #d69e2e; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 11px; cursor: pointer; transition: background 0.2s;"
                                        onmouseover="this.style.backgroundColor='#b7791f'"
                                        onmouseout="this.style.backgroundColor='#d69e2e'">
                                    üé® Í∞ïÏ°∞
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });

            html += `
                        </tbody>
                    </table>
                </div>

                <div style="margin-top: 15px; text-align: center; color: #a0aec0; font-size: 12px;">
                    üí° ÌñâÏùÑ ÎßàÏö∞Ïä§Ïò§Î≤ÑÌïòÎ©¥ ÌïòÏù¥ÎùºÏù¥Ìä∏Îê©ÎãàÎã§ | Ï†êÏàòÍ∞Ä ÎÜíÏùÑÏàòÎ°ù Í¥ÄÎ†®ÎèÑÍ∞Ä ÎÜíÏäµÎãàÎã§
                </div>
            `;

            results.innerHTML = html;
        }

        function displayCardResults(data, query) {
            const results = document.getElementById('results');
            const searchMode = data.search_mode || 'hybrid';
            let html = `
                <div style="margin-bottom: 20px; padding: 20px; background: linear-gradient(135deg, rgba(15, 20, 25, 0.9) 0%, rgba(30, 41, 59, 0.8) 100%); border-radius: 16px; border: 1px solid rgba(79, 209, 199, 0.3);">
                    <h2 style="color: #4fd1c7; margin: 0 0 12px 0; text-align: center;">üìä Í≤ÄÏÉâ Í≤∞Í≥º</h2>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; margin-bottom: 12px;">
                        <div style="text-align: center; padding: 8px; background: rgba(79, 209, 199, 0.1); border-radius: 8px;">
                            <div style="font-size: 18px; font-weight: bold; color: #4fd1c7;">${data.results.length}</div>
                            <div style="font-size: 12px; color: #a0aec0;">Í≤ÄÏÉâ Í≤∞Í≥º</div>
                        </div>
                        <div style="text-align: center; padding: 8px; background: rgba(79, 209, 199, 0.1); border-radius: 8px;">
                            <div style="font-size: 14px; font-weight: bold; color: #4fd1c7;">${searchMode.toUpperCase()}</div>
                            <div style="font-size: 12px; color: #a0aec0;">Í≤ÄÏÉâ Î™®Îìú</div>
                        </div>
                        <div style="text-align: center; padding: 8px; background: rgba(79, 209, 199, 0.1); border-radius: 8px;">
                            <div style="font-size: 14px; font-weight: bold; color: #4fd1c7;">${currentDocumentFilter === 'all' ? 'Ï†ÑÏ≤¥' : currentDocumentFilter}</div>
                            <div style="font-size: 12px; color: #a0aec0;">Î¨∏ÏÑú ÌïÑÌÑ∞</div>
                        </div>
                        <div style="text-align: center; padding: 8px; background: rgba(79, 209, 199, 0.1); border-radius: 8px;">
                            <div style="font-size: 14px; font-weight: bold; color: #4fd1c7;">${data.search_time ? Math.round(data.search_time * 1000) + 'ms' : '< 100ms'}</div>
                            <div style="font-size: 12px; color: #a0aec0;">Í≤ÄÏÉâ ÏãúÍ∞Ñ</div>
                        </div>
                    </div>

                    <div style="text-align: center; color: #a0aec0; font-size: 13px;">
                        üí° ${data.total_documents || '6,139'}Í∞ú Î¨∏ÏÑú Ï≤≠ÌÅ¨ÏóêÏÑú Í≤ÄÏÉâ ÏôÑÎ£å
                    </div>
                </div>
            `;

            data.results.forEach((result, index) => {
                const content = result.document || '';
                const highlightedContent = highlightKeywords(content, query);
                const score = result.score ? (result.score * 100).toFixed(1) : '0.0';
                const fileName = result.metadata ? result.metadata.file_name : 'Unknown';
                const pageZeroBased = result.metadata ? result.metadata.page : 0;
                const pageOneBased = pageZeroBased + 1;
                const pageLabel = result.metadata ? result.metadata.page_label : pageOneBased;
                const category = result.metadata ? result.metadata.category : 'Unknown';
                const chunkId = result.metadata ? result.metadata.chunk_id : index;
                const folderName = category === 'Ïã§Î¨¥ÏßÄÏπ®' ? 'Ïã§Î¨¥ÏßÄÏπ®(2020)' : 'ÎèÑÎ°úÏÑ§Í≥ÑÏöîÎ†π(2020)';
                const fullPath = `${folderName}/${fileName}`;

                // ÎØ∏Î¶¨Î≥¥Í∏∞ Î™®Îìú ÌÜ†Í∏Ä
                const showPreview = document.getElementById('showPreview')?.checked || false;

                let previewSection = '';
                const showImages = false; // Ïù¥ÎØ∏ÏßÄ ÌëúÏãú ÏòµÏÖò Ï†úÍ±∞

                // Ïù¥ÎØ∏ÏßÄ Î†åÎçîÎßÅ ÏãúÏä§ÌÖú Ï†úÍ±∞Îê®
                if (false) {
                    previewSection = `
                        <div class="result-preview" style="margin-top: 15px;">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                <h4 style="color: #ffa500; margin: 0; font-size: 14px;">üì∏ ÏõêÎ≥∏ Ïù¥ÎØ∏ÏßÄ (ÌÇ§ÏõåÎìú ÌïòÏù¥ÎùºÏù¥Ìä∏)</h4>
                                <span style="background: rgba(255, 165, 0, 0.2); padding: 2px 8px; border-radius: 10px; font-size: 12px; color: #ffa500;">
                                    ${document.getElementById('cropImages').checked ? '‚úÇÔ∏è ÌÅ¨Î°≠Îê®' : 'üìÑ Ï†ÑÏ≤¥ ÌéòÏù¥ÏßÄ'}
                                </span>
                            </div>
                            <div style="border: 2px solid #ffa500; border-radius: 8px; padding: 10px; background: rgba(255, 165, 0, 0.05);">
                                <img src="data:image/png;base64,${result.image_b64}"
                                     alt="PDF ÌéòÏù¥ÏßÄ ${pageLabel} ÌïòÏù¥ÎùºÏù¥Ìä∏ Ïù¥ÎØ∏ÏßÄ"
                                     style="max-width: 100%; height: auto; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); background: #ffffff; cursor: pointer;"
                                     onclick="openImageInNewTab(this.src)">
                                <div style="margin-top: 8px; font-size: 12px; color: #666; text-align: center;">
                                    üí° Ïù¥ÎØ∏ÏßÄÎ•º ÌÅ¥Î¶≠ÌïòÎ©¥ ÏÉà ÌÉ≠ÏóêÏÑú ÌôïÎåÄÌïòÏó¨ Î≥º Ïàò ÏûàÏäµÎãàÎã§
                                </div>
                            </div>
                        </div>
                    `;
                }
                // ÎØ∏Î¶¨Î≥¥Í∏∞ ÏãúÏä§ÌÖú
                if (showPreview) {
                    const encodedFileName = encodeURIComponent(fileName);
                    const highlightImageUrl = `${API_BASE_URL}/api/pdf-highlight/${encodedFileName}/${pageOneBased}/${encodeURIComponent(query)}`;

                    previewSection = `
                        <div class="result-preview">
                            <img src="${highlightImageUrl}"
                                 alt="PDF ÌéòÏù¥ÏßÄ ${pageLabel} ÎØ∏Î¶¨Î≥¥Í∏∞"
                                 style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); background: #ffffff;"
                                 onerror="this.style.display='none'">
                        </div>
                    `;
                }

                // Ïπ¥Îìú ÌòïÌÉúÏóêÏÑúÎèÑ extracted_text ÏÇ¨Ïö©
                const displayContent = result.extracted_text || content;
                const highlightedDisplayContent = highlightKeywords(displayContent, query);
                
                html += `
                    <div class="result-item">
                        <div class="result-score">Ïú†ÏÇ¨ÎèÑ: ${score}% ${result.keyword_score ? `| ÌÇ§ÏõåÎìú: ${result.keyword_score}%` : ''}</div>
                        <div class="result-content" style="white-space: pre-wrap; word-wrap: break-word; max-height: 400px; overflow-y: auto;">${highlightedDisplayContent}</div>
                        ${previewSection}
                        <div class="result-meta">
                            <span class="meta-badge">üìÑ ${fullPath}</span>
                            <span class="meta-badge">üìÑ ${pageLabel}ÌéòÏù¥ÏßÄ</span>
                            <span class="meta-badge">üî¢ Ï≤≠ÌÅ¨ ${chunkId}</span>
                            <span class="meta-badge">üíæ ${content.length}Ïûê</span>
                        </div>
                        <div class="result-actions">
                            <button class="action-btn pdf-btn" onclick="openPDF('${fullPath}', ${pageOneBased}, '${category}')">
                                üìÑ ÏõêÎ≥∏ PDF Î≥¥Í∏∞
                            </button>
                            <button class="action-btn highlight-btn" onclick="showHighlightedPage('${fullPath}', ${pageOneBased}, '${query}', '${category}')">
                                üé® ÌïòÏù¥ÎùºÏù¥Ìä∏ Î≥¥Í∏∞
                            </button>
                        </div>
                    </div>
                `;
            });

            results.innerHTML = html;
        }

        function highlightKeywords(content, query) {
            if (!content || !query) return content || '';

            const keywords = query.split(' ').filter(word => word.length > 1);
            let highlighted = content;

            keywords.forEach(keyword => {
                // ÌäπÏàòÎ¨∏Ïûê Ïù¥Ïä§ÏºÄÏù¥ÌîÑ Ï≤òÎ¶¨
                const escapedKeyword = keyword.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                const regex = new RegExp(`(${escapedKeyword})`, 'gi');
                highlighted = highlighted.replace(regex, '<span class="highlight">$1</span>');
            });

            return highlighted;
        }

        function openPDF(filename, page, category) {
            const viewerContent = document.getElementById('viewerContent');
            const encodedFilename = encodeURIComponent(filename);

            const folderName = category === 'Ïã§Î¨¥ÏßÄÏπ®' ? 'Ïã§Î¨¥ÏßÄÏπ®(2020)' : 'ÎèÑÎ°úÏÑ§Í≥ÑÏöîÎ†π(2020)';
            const fullPath = `${folderName}/${filename}`;

            viewerContent.innerHTML = `
                <div class="viewer-toolbar" style="background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%); padding: 15px 20px; border-bottom: 2px solid #4fd1c7; display: flex; justify-content: space-between; align-items: center;">
                    <div class="toolbar-left" style="display: flex; align-items: center; gap: 15px;">
                        <button onclick="closePDFViewer()"
                                style="background: #e53e3e; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 13px; transition: all 0.2s;"
                                onmouseover="this.style.backgroundColor='#c53030'"
                                onmouseout="this.style.backgroundColor='#e53e3e'">
                            ‚úñ Îã´Í∏∞
                        </button>
                        <button onclick="openPDFInNewTab('${fullPath}', ${page})"
                                style="background: #3182ce; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 13px; transition: all 0.2s;"
                                onmouseover="this.style.backgroundColor='#2c5aa0'"
                                onmouseout="this.style.backgroundColor='#3182ce'">
                            üîó ÏÉà ÌÉ≠ÏóêÏÑú Ïó¥Í∏∞
                        </button>
                    </div>

                    <div class="toolbar-center" style="text-align: center;">
                        <div style="color: #4fd1c7; font-size: 16px; font-weight: 600; margin-bottom: 2px;">üìÑ Î¨∏ÏÑú Î∑∞Ïñ¥</div>
                        <div style="color: #a0aec0; font-size: 12px;">
                            ${fullPath} - ÌéòÏù¥ÏßÄ ${page}
                        </div>
                    </div>

                    <div class="toolbar-right" style="display: flex; align-items: center; gap: 10px;">
                        <div style="background: #4fd1c7; color: #1a202c; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;">
                            ${page}p
                        </div>
                    </div>
                </div>

                <div style="height: calc(100% - 80px); background: #f7fafc; padding: 10px;">
                    <iframe id="pdfIframe"
                            src="${API_BASE_URL}/api/pdf/${encodedFilename}#page=${page}"
                            width="100%"
                            height="100%"
                            style="border: none; background: white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                    </iframe>
                </div>
            `;
        }

        // Ïù¥ÎØ∏ÏßÄ Î°úÎìú Ïã§Ìå® Ïãú ÎåÄÏ≤¥ PDF ÌëúÏãú
        function handleImageError(pdfUrl, page) {
            const container = document.querySelector('.pdf-image-container div');
            container.innerHTML = `
                <div style="padding: 20px; text-align: center;">
                    <p style="color: #666; margin-bottom: 20px;">Ïù¥ÎØ∏ÏßÄ Î°úÎî©Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. ÏõêÎ≥∏ PDFÎ°ú ÌëúÏãúÌï©ÎãàÎã§.</p>
                    <embed src="${pdfUrl}#page=${page}" type="application/pdf"
                           style="width: 100%; height: 600px; background: #ffffff; border: 1px solid #ddd; border-radius: 8px;">
                </div>
            `;
        }

        // Ï§å Í∏∞Îä•
        let currentZoom = 1.0;
        function zoomIn() {
            const img = document.getElementById('pdfPageImage');
            if (img) {
                currentZoom += 0.2;
                img.style.transform = `scale(${currentZoom})`;
                img.style.transformOrigin = 'top center';
            }
        }

        function zoomOut() {
            const img = document.getElementById('pdfPageImage');
            if (img && currentZoom > 0.4) {
                currentZoom -= 0.2;
                img.style.transform = `scale(${currentZoom})`;
                img.style.transformOrigin = 'top center';
            }
        }


        function openPDFInNewTab(filename, page) {
            const encodedFilename = encodeURIComponent(filename);
            const pdfUrl = `${API_BASE_URL}/api/pdf/${encodedFilename}#page=${page}`;
            window.open(pdfUrl, '_blank');
        }

        function closePDFViewer() {
            const viewerContent = document.getElementById('viewerContent');
            viewerContent.innerHTML = `
                <div class="empty-state">
                    <div style="text-align: center; padding: 60px 20px; color: #718096;">
                        <div style="font-size: 4rem; margin-bottom: 20px;">üìñ</div>
                        <h3 style="color: #2d3748; margin-bottom: 10px;">Î¨∏ÏÑúÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî</h3>
                        <p>Í≤ÄÏÉâ Í≤∞Í≥ºÏóêÏÑú "ÏõêÎ≥∏ PDF Î≥¥Í∏∞" ÎòêÎäî "ÌïòÏù¥ÎùºÏù¥Ìä∏ Î≥¥Í∏∞"Î•º ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî</p>
                    </div>
                </div>
            `;
        }

        function closePDF() {
            document.getElementById('pdfViewer').style.display = 'none';
            document.getElementById('pdfFrame').src = '';
        }

        function showHighlightedPage(filename, page, keyword, category) {
            const viewerContent = document.getElementById('viewerContent');
            const encodedFilename = encodeURIComponent(filename);
            const encodedKeyword = encodeURIComponent(keyword);

            const folderName = category === 'Ïã§Î¨¥ÏßÄÏπ®' ? 'Ïã§Î¨¥ÏßÄÏπ®(2020)' : 'ÎèÑÎ°úÏÑ§Í≥ÑÏöîÎ†π(2020)';
            const fullPath = `${folderName}/${filename}`;

            viewerContent.innerHTML = `
                <div class="viewer-toolbar" style="background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%); padding: 15px 20px; border-bottom: 2px solid #f59e0b; display: flex; justify-content: space-between; align-items: center;">
                    <div class="toolbar-left" style="display: flex; align-items: center; gap: 15px;">
                        <button onclick="closePDFViewer()"
                                style="background: #e53e3e; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 13px; transition: all 0.2s;"
                                onmouseover="this.style.backgroundColor='#c53030'"
                                onmouseout="this.style.backgroundColor='#e53e3e'">
                            ‚úñ Îã´Í∏∞
                        </button>
                        <button onclick="openPDF('${fullPath}', ${page}, '${category}')"
                                style="background: #4fd1c7; color: #1a202c; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500; transition: all 0.2s;"
                                onmouseover="this.style.backgroundColor='#38b2ac'"
                                onmouseout="this.style.backgroundColor='#4fd1c7'">
                            üìÑ ÏõêÎ≥∏ Î≥¥Í∏∞
                        </button>
                        <button onclick="openPDFInNewTab('${fullPath}', ${page})"
                                style="background: #3182ce; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 13px; transition: all 0.2s;"
                                onmouseover="this.style.backgroundColor='#2c5aa0'"
                                onmouseout="this.style.backgroundColor='#3182ce'">
                            üîó ÏÉà ÌÉ≠ÏóêÏÑú Ïó¥Í∏∞
                        </button>
                    </div>

                    <div class="toolbar-center" style="text-align: center;">
                        <div style="color: #f59e0b; font-size: 16px; font-weight: 600; margin-bottom: 2px;">üé® ÌïòÏù¥ÎùºÏù¥Ìä∏ Î∑∞Ïñ¥</div>
                        <div style="color: #a0aec0; font-size: 12px;">
                            ${fullPath} - ÌéòÏù¥ÏßÄ ${page}
                        </div>
                    </div>

                    <div class="toolbar-right" style="display: flex; align-items: center; gap: 10px;">
                        <div style="background: #f59e0b; color: #1a202c; padding: 4px 8px; border-radius: 12px; font-size: 11px; font-weight: 600; max-width: 120px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${keyword}">
                            "${keyword}"
                        </div>
                        <div style="background: #4fd1c7; color: #1a202c; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;">
                            ${page}p
                        </div>
                    </div>
                </div>

                <div style="height: calc(100% - 80px); background: #f7fafc; padding: 20px; text-align: center; overflow-y: auto;">
                    <div style="background: white; border-radius: 12px; padding: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); display: inline-block; max-width: 100%;">
                        <img src="${API_BASE_URL}/api/pdf-highlight/${encodedFilename}/${page}/${encodedKeyword}"
                             alt="PDF ÌéòÏù¥ÏßÄ ${page} ÌïòÏù¥ÎùºÏù¥Ìä∏"
                             style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); background: #ffffff;"
                             onerror="this.onerror=null; this.src='${API_BASE_URL}/api/pdf-page-image/${encodedFilename}/${page}'; this.alt='PDF ÌéòÏù¥ÏßÄ ${page} (ÌïòÏù¥ÎùºÏù¥Ìä∏ Ïã§Ìå®)';">
                        <div style="margin-top: 15px; padding: 10px; background: #fef3cd; border-radius: 8px; border-left: 4px solid #f59e0b;">
                            <p style="margin: 0; color: #92400e; font-size: 14px; font-weight: 500;">
                                üí° "${keyword}" ÌÇ§ÏõåÎìúÍ∞Ä ÎÖ∏ÎûÄÏÉâÏúºÎ°ú ÌïòÏù¥ÎùºÏù¥Ìä∏Îê©ÎãàÎã§
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }

        // ÌÜµÌï© PDF Î∑∞Ïñ¥ Î≥ÄÏàò
        let currentPDFInfo = null;
        let currentPDFMode = 'original'; // 'original' or 'highlight'
        let currentHighlightKeyword = '';
        let currentPDFZoom = 1.0;
        let highlightPages = []; // Í≤ÄÏÉâ Í≤∞Í≥º ÌéòÏù¥ÏßÄÎì§
        let preloadedImages = new Map(); // ÌîÑÎ¶¨Î°úÎî©Îêú Ïù¥ÎØ∏ÏßÄ Ï∫êÏãú
        let currentVisiblePage = 1;

        // ÌÜµÌï© PDF Î∑∞Ïñ¥ Ìï®Ïàò
        async function openUnifiedPDFViewer(filename, targetPage, mode = 'original', keyword = '') {
            try {
                // PDF Ï†ïÎ≥¥Î•º ÎåÄÎûµÏ†ÅÏúºÎ°ú ÏÑ§Ï†ï
                currentPDFInfo = {
                    filename: filename,
                    total_pages: 1000, // ÎåÄÎûµÏ†ÅÏù∏ ÌÅ∞ Í∞íÏúºÎ°ú ÏÑ§Ï†ï
                    metadata: {
                        title: filename,
                        author: "",
                        creator: "",
                        producer: ""
                    }
                };
                currentPDFMode = mode;
                currentHighlightKeyword = keyword;
                currentPDFZoom = 1.0;
                currentVisiblePage = targetPage;

                // ÌïòÏù¥ÎùºÏù¥Ìä∏ Î™®ÎìúÏùº Îïå Í≤ÄÏÉâ Í≤∞Í≥º ÌéòÏù¥ÏßÄÎì§ ÏàòÏßë
                if (mode === 'highlight' && keyword) {
                    await collectHighlightPages(filename, keyword);
                }

                // Ïö∞Ï∏° Ìå®ÎÑêÏóê Ïä§ÌÅ¨Î°§ Î∑∞Ïñ¥ ÌëúÏãú
                showScrollPDFViewer(filename, targetPage);

            } catch (error) {
                console.error('ÌÜµÌï© PDF Î∑∞Ïñ¥ Ïò§Î•ò:', error);
                alert('PDF Î∑∞Ïñ¥ Î°úÎî© Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            }
        }

        // Í≤ÄÏÉâ Í≤∞Í≥º ÌéòÏù¥ÏßÄ ÏàòÏßë Ìï®Ïàò
        async function collectHighlightPages(filename, keyword) {
            try {
                // ÌòÑÏû¨ Í≤ÄÏÉâ Í≤∞Í≥ºÏóêÏÑú Ìï¥Îãπ ÌååÏùºÏùò ÌéòÏù¥ÏßÄÎì§ Ï∂îÏ∂ú
                const searchResults = document.querySelectorAll('.search-result');
                highlightPages = [];

                searchResults.forEach(result => {
                    const fileNameElement = result.querySelector('h4');
                    if (fileNameElement && fileNameElement.textContent.includes(filename)) {
                        const pageMatch = result.textContent.match(/ÌéòÏù¥ÏßÄ\s*(\d+)/);
                        if (pageMatch) {
                            const pageNum = parseInt(pageMatch[1]);
                            if (!highlightPages.includes(pageNum)) {
                                highlightPages.push(pageNum);
                            }
                        }
                    }
                });

            } catch (error) {
                console.error('ÌïòÏù¥ÎùºÏù¥Ìä∏ ÌéòÏù¥ÏßÄ ÏàòÏßë Ïò§Î•ò:', error);
                highlightPages = [];
            }
        }

        // Ïä§ÌÅ¨Î°§ PDF Î∑∞Ïñ¥ ÌëúÏãú Ìï®Ïàò
        function showScrollPDFViewer(filename, targetPage) {
            const viewerContent = document.getElementById('viewerContent');

            // ÎìÄÏñº Î™®Îìú: ÏõêÎ≥∏ÏùÄ iframe, ÌïòÏù¥ÎùºÏù¥Ìä∏Îäî Ïù¥ÎØ∏ÏßÄ Î∞©Ïãù
            if (currentPDFMode === 'original') {
                // ÏõêÎ≥∏ Î™®Îìú - iframeÏúºÎ°ú Í≥†ÌíàÏßà PDF ÌëúÏãú
                showOriginalPDFViewer(filename, targetPage);
            } else {
                // ÌïòÏù¥ÎùºÏù¥Ìä∏ Î™®Îìú - Ïù¥ÎØ∏ÏßÄ Î∞©ÏãùÏúºÎ°ú Ï†úÌïúÎêú ÌéòÏù¥ÏßÄÎßå ÌëúÏãú
                showHighlightPDFViewer(filename, targetPage);
            }
        }

        // ÏõêÎ≥∏ PDF Î∑∞Ïñ¥ (iframe Î∞©Ïãù)
        function showOriginalPDFViewer(filename, targetPage) {
            const viewerContent = document.getElementById('viewerContent');
            const encodedFilename = encodeURIComponent(filename);

            viewerContent.innerHTML = `
                <div class="unified-viewer-toolbar">
                    <button onclick="closePDFViewer()">‚úñ Îã´Í∏∞</button>
                    <button onclick="toggleViewMode()" title="Î≥¥Í∏∞ Î™®Îìú Ï†ÑÌôò">
                        üé® ÌïòÏù¥ÎùºÏù¥Ìä∏ Î™®ÎìúÎ°ú Ï†ÑÌôò
                    </button>
                    <button onclick="openPDFInNewTab('${filename}', ${targetPage})">üîó ÏÉà ÌÉ≠</button>
                    <div class="viewer-info">üìÑ ÏõêÎ≥∏ PDF - ${filename}</div>
                </div>

                <div style="height: calc(100% - 60px); background: #ffffff;">
                    <iframe id="pdfIframe"
                            src="${API_BASE_URL}/api/pdf/${encodedFilename}#page=${targetPage}"
                            width="100%"
                            height="100%"
                            style="border: none; background: white;">
                    </iframe>
                </div>
            `;
        }

        // ÌïòÏù¥ÎùºÏù¥Ìä∏ PDF Î∑∞Ïñ¥ (Ïù¥ÎØ∏ÏßÄ Î∞©Ïãù, Ï†úÌïúÎêú ÌéòÏù¥ÏßÄ)
        function showHighlightPDFViewer(filename, targetPage) {
            const viewerContent = document.getElementById('viewerContent');

            // ÌïòÏù¥ÎùºÏù¥Ìä∏ ÌéòÏù¥ÏßÄ Ï†ïÎ≥¥
            const highlightInfo = `üé® ÌïòÏù¥ÎùºÏù¥Ìä∏: "${currentHighlightKeyword}" (${highlightPages.length}Í∞ú ÌéòÏù¥ÏßÄ)`;

            viewerContent.innerHTML = `
                <div class="unified-viewer-toolbar">
                    <button onclick="closePDFViewer()">‚úñ Îã´Í∏∞</button>
                    <button onclick="toggleViewMode()" title="Î≥¥Í∏∞ Î™®Îìú Ï†ÑÌôò">
                        üìÑ ÏõêÎ≥∏ Î™®ÎìúÎ°ú Ï†ÑÌôò
                    </button>
                    <button onclick="zoomInUnified()">üîç+ ÌôïÎåÄ</button>
                    <button onclick="zoomOutUnified()">üîç- Ï∂ïÏÜå</button>
                    <button onclick="navigateHighlightPages()" title="ÌïòÏù¥ÎùºÏù¥Ìä∏ ÌéòÏù¥ÏßÄ ÌÉêÏÉâ">üéØ ÌïòÏù¥ÎùºÏù¥Ìä∏ ÌéòÏù¥ÏßÄ</button>
                    <div class="viewer-info">${highlightInfo} - ${filename}</div>
                </div>

                <div id="scrollPdfContainer" class="scroll-pdf-container" style="height: calc(100% - 60px); background: #ffffff; overflow-y: auto;">
                    <div class="scroll-status" style="position: sticky; top: 0; background: #ffffff; padding: 10px; border-bottom: 1px solid #e2e8f0; z-index: 10; text-align: center;">
                        <span id="currentPageIndicator">ÌéòÏù¥ÏßÄ ${targetPage} (ÌïòÏù¥ÎùºÏù¥Ìä∏ Î™®Îìú)</span>
                    </div>

                    <div id="pdfScrollContent" style="padding: 20px;">
                    </div>
                </div>
            `;

            // Ïä§ÌÅ¨Î°§ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Îì±Î°ù (ÌïòÏù¥ÎùºÏù¥Ìä∏ Î™®ÎìúÏö©)
            const scrollContainer = document.getElementById('scrollPdfContainer');
            scrollContainer.addEventListener('scroll', handleHighlightScroll);

            // ÌïòÏù¥ÎùºÏù¥Ìä∏ Î™®Îìú Ï¥àÍ∏∞ ÌéòÏù¥ÏßÄ Î°úÎìú (Ï†úÌïúÎêú Î≤îÏúÑ)
            loadHighlightPages(filename, targetPage);
        }

        // ÌïòÏù¥ÎùºÏù¥Ìä∏ Î™®Îìú ÌéòÏù¥ÏßÄ Î°úÎìú (Ï†úÌïúÎêú Î≤îÏúÑ)
        async function loadHighlightPages(filename, targetPage) {
            const scrollContent = document.getElementById('pdfScrollContent');
            if (!scrollContent) return;

            // ÌïòÏù¥ÎùºÏù¥Ìä∏ Î™®ÎìúÎäî Ï†ÑÌõÑ 3-4ÌéòÏù¥ÏßÄÎßå Î°úÎìú
            const limitedRange = 3;
            const startPage = Math.max(1, targetPage - limitedRange);
            const endPage = Math.min(currentPDFInfo.total_pages, targetPage + limitedRange);

            // ÌéòÏù¥ÏßÄ Ïª®ÌÖåÏù¥ÎÑàÎì§ ÏÉùÏÑ±
            let containerHTML = '';
            let hasHighlightPages = false;

            for (let i = startPage; i <= endPage; i++) {
                const isHighlightPage = highlightPages.includes(i);
                if (isHighlightPage) hasHighlightPages = true;

                containerHTML += `
                    <div class="page-container" id="page-${i}" style="margin-bottom: 30px; text-align: center;">
                        <div class="page-header" style="background: ${isHighlightPage ? '#fef3c7' : '#f7fafc'}; padding: 10px; margin-bottom: 10px; border-radius: 8px;">
                            <strong>üìÑ ÌéòÏù¥ÏßÄ ${i}</strong>
                            ${isHighlightPage ? ' üé® ÌïòÏù¥ÎùºÏù¥Ìä∏' : ''}
                        </div>
                        <div class="loading-spinner" style="margin: 50px auto;"></div>
                        <p>ÌéòÏù¥ÏßÄÎ•º Î°úÎî© Ï§ë...</p>
                    </div>
                `;
            }

            // ÌïòÏù¥ÎùºÏù¥Ìä∏ ÌéòÏù¥ÏßÄÍ∞Ä ÏóÜÏúºÎ©¥ ÏïàÎÇ¥ Î©îÏãúÏßÄ
            if (!hasHighlightPages && highlightPages.length > 0) {
                containerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <p style="color: #718096;">Ïù¥ Î≤îÏúÑÏóêÎäî ÌïòÏù¥ÎùºÏù¥Ìä∏ ÌéòÏù¥ÏßÄÍ∞Ä ÏóÜÏäµÎãàÎã§.</p>
                        <p style="margin-top: 10px;">ÌïòÏù¥ÎùºÏù¥Ìä∏ ÌéòÏù¥ÏßÄ: ${highlightPages.join(', ')}</p>
                        <button onclick="goToNearestHighlight(${targetPage})"
                                style="margin-top: 20px; padding: 10px 20px; background: #4fd1c7; color: white; border: none; border-radius: 8px; cursor: pointer;">
                            üéØ Í∞ÄÏû• Í∞ÄÍπåÏö¥ ÌïòÏù¥ÎùºÏù¥Ìä∏ ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô
                        </button>
                    </div>
                ` + containerHTML;
            }

            scrollContent.innerHTML = containerHTML;

            // ÌÉÄÍ≤ü ÌéòÏù¥ÏßÄ Î®ºÏ†Ä Î°úÎìú
            await loadPageImage(filename, targetPage);

            // ÌÉÄÍ≤ü ÌéòÏù¥ÏßÄÎ°ú Ïä§ÌÅ¨Î°§
            setTimeout(() => {
                const pageElement = document.getElementById(`page-${targetPage}`);
                if (pageElement) {
                    pageElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 100);

            // ÎÇòÎ®∏ÏßÄ ÌéòÏù¥ÏßÄÎì§ ÏàúÏ∞®Ï†ÅÏúºÎ°ú Î°úÎìú (ÌïòÏù¥ÎùºÏù¥Ìä∏ Ïö∞ÏÑ†)
            for (let i = startPage; i <= endPage; i++) {
                if (i !== targetPage) {
                    const priority = highlightPages.includes(i) ? 0 : 1;
                    setTimeout(() => loadPageImage(filename, i), (Math.abs(i - targetPage) + priority) * 300);
                }
            }
        }

        // ÌïòÏù¥ÎùºÏù¥Ìä∏ Î™®Îìú Ïä§ÌÅ¨Î°§ Ï≤òÎ¶¨
        function handleHighlightScroll() {
            // ÌïòÏù¥ÎùºÏù¥Ìä∏ Î™®ÎìúÏóêÏÑúÎäî Ï†úÌïúÎêú Ïä§ÌÅ¨Î°§Îßå Ï≤òÎ¶¨
            const container = document.getElementById('scrollPdfContainer');
            const indicator = document.getElementById('currentPageIndicator');

            if (!container || !indicator) return;

            // ÌòÑÏû¨ Î≥¥Ïù¥Îäî ÌéòÏù¥ÏßÄ ÏóÖÎç∞Ïù¥Ìä∏
            const scrollTop = container.scrollTop;
            const pages = container.querySelectorAll('.page-container');

            pages.forEach((page) => {
                const pageTop = page.offsetTop - container.offsetTop;
                const pageBottom = pageTop + page.offsetHeight;

                if (pageTop <= scrollTop + 100 && pageBottom >= scrollTop + 100) {
                    const pageMatch = page.id.match(/page-(\d+)/);
                    if (pageMatch) {
                        const pageNum = parseInt(pageMatch[1]);
                        indicator.textContent = `ÌéòÏù¥ÏßÄ ${pageNum} (ÌïòÏù¥ÎùºÏù¥Ìä∏ Î™®Îìú)`;
                    }
                }
            });
        }

        // Í∞ÄÏû• Í∞ÄÍπåÏö¥ ÌïòÏù¥ÎùºÏù¥Ìä∏ ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô
        function goToNearestHighlight(currentPage) {
            if (highlightPages.length === 0) return;

            let nearestPage = highlightPages[0];
            let minDistance = Math.abs(currentPage - nearestPage);

            highlightPages.forEach(page => {
                const distance = Math.abs(currentPage - page);
                if (distance < minDistance) {
                    minDistance = distance;
                    nearestPage = page;
                }
            });

            // Ìï¥Îãπ ÌéòÏù¥ÏßÄÎ°ú Îã§Ïãú Î°úÎìú
            loadHighlightPages(currentPDFInfo.filename, nearestPage);
        }

        // ÌïòÏù¥ÎùºÏù¥Ìä∏ ÌéòÏù¥ÏßÄ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò
        function navigateHighlightPages() {
            if (highlightPages.length === 0) {
                alert('ÌïòÏù¥ÎùºÏù¥Ìä∏ ÌéòÏù¥ÏßÄÍ∞Ä ÏóÜÏäµÎãàÎã§.');
                return;
            }

            const pageList = highlightPages.join(', ');
            const pageNum = prompt(`ÌïòÏù¥ÎùºÏù¥Ìä∏ ÌéòÏù¥ÏßÄ Î™©Î°ù: ${pageList}\n\nÏù¥ÎèôÌï† ÌéòÏù¥ÏßÄ Î≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî:`, highlightPages[0]);

            if (pageNum && highlightPages.includes(parseInt(pageNum))) {
                loadHighlightPages(currentPDFInfo.filename, parseInt(pageNum));
            } else if (pageNum) {
                alert('Ìï¥Îãπ ÌéòÏù¥ÏßÄÎäî ÌïòÏù¥ÎùºÏù¥Ìä∏ ÌéòÏù¥ÏßÄÍ∞Ä ÏïÑÎãôÎãàÎã§.');
            }
        }

        // Ï¥àÍ∏∞ ÌéòÏù¥ÏßÄ Î°úÎìú Ìï®Ïàò (Í∏∞Ï°¥ - ÏõêÎ≥∏ Î™®ÎìúÏö©ÏúºÎ°ú ÎÇ®Í≤®Îë†)
        async function loadInitialPages(filename, targetPage) {
            const scrollContent = document.getElementById('pdfScrollContent');

            // ÏõêÎ≥∏ Î™®ÎìúÏùº ÎïåÎäî Îçî ÎßéÏùÄ ÌéòÏù¥ÏßÄÎ•º ÎØ∏Î¶¨ Ï§ÄÎπÑ
            const initialLoadRange = currentPDFMode === 'original' ? 5 : 2;

            // Î°úÎìúÌï† ÌéòÏù¥ÏßÄ Î≤îÏúÑ Í≥ÑÏÇ∞ (ÏúÑÏïÑÎûò Ìè¨Ìï®)
            const startPage = Math.max(1, targetPage - initialLoadRange);
            const endPage = Math.min(currentPDFInfo.total_pages, targetPage + initialLoadRange);

            // ÌéòÏù¥ÏßÄ Ïª®ÌÖåÏù¥ÎÑàÎì§ ÏÉùÏÑ±
            let containerHTML = '';
            for (let i = startPage; i <= endPage; i++) {
                const isHighlightPage = highlightPages.includes(i);
                containerHTML += `
                    <div class="page-container" id="page-${i}" style="margin-bottom: 30px; text-align: center;">
                        <div class="page-header" style="background: #f7fafc; padding: 10px; margin-bottom: 10px; border-radius: 8px;">
                            <strong>üìÑ ÌéòÏù¥ÏßÄ ${i}</strong>
                            ${isHighlightPage ? ' üé®' : ''}
                        </div>
                        <div class="loading-spinner" style="margin: 50px auto;"></div>
                        <p>ÌéòÏù¥ÏßÄÎ•º Î°úÎî© Ï§ë...</p>
                    </div>
                `;
            }

            scrollContent.innerHTML = containerHTML;

            // ÌÉÄÍ≤ü ÌéòÏù¥ÏßÄ Î®ºÏ†Ä Î°úÎìú
            await loadPageImage(filename, targetPage);

            // ÌÉÄÍ≤ü ÌéòÏù¥ÏßÄÎ°ú Ïä§ÌÅ¨Î°§
            setTimeout(() => {
                const pageElement = document.getElementById(`page-${targetPage}`);
                if (pageElement) {
                    pageElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 100);

            // ÎÇòÎ®∏ÏßÄ ÌéòÏù¥ÏßÄÎì§ ÏàúÏ∞®Ï†ÅÏúºÎ°ú Î°úÎìú
            for (let i = startPage; i <= endPage; i++) {
                if (i !== targetPage) {
                    setTimeout(() => loadPageImage(filename, i), Math.abs(i - targetPage) * 300);
                }
            }

            // Ï∂îÍ∞Ä ÌîÑÎ¶¨Î°úÎî© ÏãúÏûë
            setTimeout(() => preloadAdjacentPages(filename, targetPage), 2000);
        }

        // Í∞úÎ≥Ñ ÌéòÏù¥ÏßÄ Ïù¥ÎØ∏ÏßÄ Î°úÎìú Ìï®Ïàò
        async function loadPageImage(filename, pageNum) {
            const pageContainer = document.getElementById(`page-${pageNum}`);
            if (!pageContainer) return;

            const encodedFilename = encodeURIComponent(filename);

            try {
                // Ï∫êÏãú ÌôïÏù∏
                const cacheKey = `${filename}-${pageNum}-${currentPDFMode}`;
                if (preloadedImages.has(cacheKey)) {
                    const cachedUrl = preloadedImages.get(cacheKey);
                    displayPageImage(pageContainer, cachedUrl, pageNum);
                    return;
                }

                // URL Í≤∞Ï†ï (ÌïòÏù¥ÎùºÏù¥Ìä∏ ÌéòÏù¥ÏßÄÏù∏ÏßÄ ÌôïÏù∏)
                let imageUrl;
                const isHighlightPage = highlightPages.includes(pageNum);

                if (currentPDFMode === 'highlight' && isHighlightPage && currentHighlightKeyword) {
                    imageUrl = `${API_BASE_URL}/api/pdf-highlight/${encodedFilename}/${pageNum}/${encodeURIComponent(currentHighlightKeyword)}`;
                } else {
                    imageUrl = `${API_BASE_URL}/api/pdf-page-image/${encodedFilename}/${pageNum}`;
                }

                // Ïù¥ÎØ∏ÏßÄ Î°úÎìú
                const img = new Image();
                img.onload = () => {
                    // Ï∫êÏãúÏóê Ï†ÄÏû•
                    preloadedImages.set(cacheKey, imageUrl);
                    displayPageImage(pageContainer, imageUrl, pageNum);
                };

                img.onerror = () => {
                    pageContainer.innerHTML = `
                        <div class="page-header" style="background: #f7fafc; padding: 10px; margin-bottom: 10px; border-radius: 8px;">
                            <strong>üìÑ ÌéòÏù¥ÏßÄ ${pageNum}</strong>
                        </div>
                        <div style="padding: 40px; color: #e53e3e; border: 2px dashed #fed7d7; border-radius: 8px;">
                            <div style="font-size: 2rem; margin-bottom: 15px;">‚ö†Ô∏è</div>
                            <h4>ÌéòÏù¥ÏßÄ Î°úÎìú Ïã§Ìå®</h4>
                            <button onclick="retryLoadPage('${filename}', ${pageNum})" style="margin-top: 10px; padding: 8px 16px; background: #4fd1c7; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                üîÑ Îã§Ïãú ÏãúÎèÑ
                            </button>
                        </div>
                    `;
                };

                img.src = imageUrl;

            } catch (error) {
                console.error(`ÌéòÏù¥ÏßÄ ${pageNum} Î°úÎìú Ïò§Î•ò:`, error);
                pageContainer.innerHTML = `
                    <div class="page-header" style="background: #f7fafc; padding: 10px; margin-bottom: 10px; border-radius: 8px;">
                        <strong>üìÑ ÌéòÏù¥ÏßÄ ${pageNum}</strong>
                    </div>
                    <div style="padding: 40px; color: #e53e3e;">
                        <h4>Î°úÎìú Ïò§Î•ò</h4>
                        <p>ÌéòÏù¥ÏßÄ Î°úÎìú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.</p>
                    </div>
                `;
            }
        }

        // ÌéòÏù¥ÏßÄ Ïù¥ÎØ∏ÏßÄ ÌëúÏãú Ìï®Ïàò
        function displayPageImage(container, imageUrl, pageNum) {
            const isHighlightPage = highlightPages.includes(pageNum);

            container.innerHTML = `
                <div class="page-header" style="background: #f7fafc; padding: 10px; margin-bottom: 10px; border-radius: 8px;">
                    <strong>üìÑ ÌéòÏù¥ÏßÄ ${pageNum}</strong>
                    ${isHighlightPage ? ' üé®' : ''}
                    ${isHighlightPage && currentPDFMode === 'highlight' ?
                        `<span style="color: #d69e2e; font-size: 0.9rem;"> (ÌïòÏù¥ÎùºÏù¥Ìä∏ Ï†ÅÏö©)</span>` : ''}
                </div>
                <img src="${imageUrl}"
                     alt="PDF ÌéòÏù¥ÏßÄ ${pageNum}"
                     style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); background: #ffffff; transform: scale(${currentPDFZoom});"
                     onclick="toggleZoom()">
                ${isHighlightPage && currentPDFMode === 'highlight' ?
                    `<p style="margin-top: 15px; color: #718096; font-size: 0.9rem; text-align: center;">
                        üí° "${currentHighlightKeyword}" ÌÇ§ÏõåÎìúÍ∞Ä ÎÖ∏ÎûÄÏÉâÏúºÎ°ú ÌïòÏù¥ÎùºÏù¥Ìä∏Îê©ÎãàÎã§
                    </p>` : ''}
            `;
        }

        // Ïù∏Ï†ë ÌéòÏù¥ÏßÄ ÌîÑÎ¶¨Î°úÎî© Ìï®Ïàò
        function preloadAdjacentPages(filename, currentPage) {
            const preloadRange = 2; // ÏúÑÏïÑÎûò 2ÌéòÏù¥ÏßÄÏî©

            for (let i = currentPage - preloadRange; i <= currentPage + preloadRange; i++) {
                if (i > 0 && i <= currentPDFInfo.total_pages && i !== currentPage) {
                    // Î∞±Í∑∏ÎùºÏö¥ÎìúÏóêÏÑú ÌîÑÎ¶¨Î°úÎî©
                    setTimeout(() => preloadPage(filename, i), (Math.abs(i - currentPage) * 500));
                }
            }
        }

        // Í∞úÎ≥Ñ ÌéòÏù¥ÏßÄ ÌîÑÎ¶¨Î°úÎî© Ìï®Ïàò
        async function preloadPage(filename, pageNum) {
            const encodedFilename = encodeURIComponent(filename);
            const cacheKey = `${filename}-${pageNum}-${currentPDFMode}`;

            // Ïù¥ÎØ∏ Ï∫êÏãúÎêòÏñ¥ ÏûàÏúºÎ©¥ Ïä§ÌÇµ
            if (preloadedImages.has(cacheKey)) return;

            try {
                // URL Í≤∞Ï†ï
                let imageUrl;
                const isHighlightPage = highlightPages.includes(pageNum);

                if (currentPDFMode === 'highlight' && isHighlightPage && currentHighlightKeyword) {
                    imageUrl = `${API_BASE_URL}/api/pdf-highlight/${encodedFilename}/${pageNum}/${encodeURIComponent(currentHighlightKeyword)}`;
                } else {
                    imageUrl = `${API_BASE_URL}/api/pdf-page-image/${encodedFilename}/${pageNum}`;
                }

                // Î∞±Í∑∏ÎùºÏö¥Îìú Î°úÎî©
                const img = new Image();
                img.onload = () => {
                    preloadedImages.set(cacheKey, imageUrl);
                };
                img.src = imageUrl;

            } catch (error) {
                console.error(`ÌéòÏù¥ÏßÄ ${pageNum} ÌîÑÎ¶¨Î°úÎî© Ïã§Ìå®:`, error);
            }
        }

        // Ïä§ÌÅ¨Î°§ Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨ Ìï®Ïàò
        let scrollTimeout;
        function handlePDFScroll() {
            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(() => {
                const container = document.getElementById('scrollPdfContainer');
                const scrollContent = document.getElementById('pdfScrollContent');

                if (!container || !scrollContent) return;

                // ÌòÑÏû¨ Î≥¥Ïù¥Îäî ÌéòÏù¥ÏßÄ Í≥ÑÏÇ∞
                const scrollTop = container.scrollTop;
                const containerHeight = container.clientHeight;
                const pages = scrollContent.querySelectorAll('.page-container');

                let visiblePage = currentVisiblePage;
                pages.forEach((page) => {
                    const pageTop = page.offsetTop - scrollContent.offsetTop;
                    const pageBottom = pageTop + page.offsetHeight;

                    if (pageTop <= scrollTop + containerHeight / 2 && pageBottom >= scrollTop + containerHeight / 2) {
                        const pageMatch = page.id.match(/page-(\d+)/);
                        if (pageMatch) {
                            visiblePage = parseInt(pageMatch[1]);
                        }
                    }
                });

                // ÌòÑÏû¨ ÌéòÏù¥ÏßÄ ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
                if (visiblePage !== currentVisiblePage) {
                    currentVisiblePage = visiblePage;
                    const indicator = document.getElementById('currentPageIndicator');
                    if (indicator) {
                        indicator.textContent = `ÌòÑÏû¨ ÌéòÏù¥ÏßÄ: ${visiblePage}`;
                    }

                    // ÏÉàÎ°úÏö¥ ÌéòÏù¥ÏßÄ Ï£ºÎ≥Ä ÌîÑÎ¶¨Î°úÎî©
                    if (currentPDFInfo) {
                        preloadAdjacentPages(currentPDFInfo.filename, visiblePage);
                    }
                }

                // ÏñëÎ∞©Ìñ• Î¨¥Ìïú Ïä§ÌÅ¨Î°§
                const scrollPercentage = (scrollTop + containerHeight) / scrollContent.scrollHeight;

                // ÌïòÎã® Í∑ºÏ≤òÏóêÏÑú Îã§Ïùå ÌéòÏù¥ÏßÄÎì§ Î°úÎìú
                if (scrollPercentage > 0.8) {
                    loadMorePages('down');
                }

                // ÏÉÅÎã® Í∑ºÏ≤òÏóêÏÑú Ïù¥Ï†Ñ ÌéòÏù¥ÏßÄÎì§ Î°úÎìú
                if (scrollTop < containerHeight * 0.5) {
                    loadMorePages('up');
                }

            }, 100);
        }

        // Ï∂îÍ∞Ä ÌéòÏù¥ÏßÄ Î°úÎìú Ìï®Ïàò (ÏñëÎ∞©Ìñ• Î¨¥Ìïú Ïä§ÌÅ¨Î°§)
        function loadMorePages(direction = 'down') {
            const scrollContent = document.getElementById('pdfScrollContent');
            if (!scrollContent || !currentPDFInfo) return;

            const existingPages = scrollContent.querySelectorAll('.page-container');
            if (existingPages.length === 0) return;

            if (direction === 'down') {
                // ÌïòÎã®Ïóê ÌéòÏù¥ÏßÄ Ï∂îÍ∞Ä
                const lastPageNum = parseInt(existingPages[existingPages.length - 1].id.split('-')[1]);

                for (let i = 1; i <= 3; i++) {
                    const nextPage = lastPageNum + i;
                    if (nextPage <= currentPDFInfo.total_pages && !document.getElementById(`page-${nextPage}`)) {
                        addPageContainer(nextPage, 'bottom');
                        setTimeout(() => loadPageImage(currentPDFInfo.filename, nextPage), i * 200);
                    }
                }
            } else if (direction === 'up') {
                // ÏÉÅÎã®Ïóê ÌéòÏù¥ÏßÄ Ï∂îÍ∞Ä
                const firstPageNum = parseInt(existingPages[0].id.split('-')[1]);

                for (let i = 1; i <= 3; i++) {
                    const prevPage = firstPageNum - i;
                    if (prevPage >= 1 && !document.getElementById(`page-${prevPage}`)) {
                        addPageContainer(prevPage, 'top');
                        setTimeout(() => loadPageImage(currentPDFInfo.filename, prevPage), i * 200);
                    }
                }
            }
        }

        // ÌéòÏù¥ÏßÄ Ïª®ÌÖåÏù¥ÎÑà Ï∂îÍ∞Ä Ìï®Ïàò
        function addPageContainer(pageNum, position = 'bottom') {
            const scrollContent = document.getElementById('pdfScrollContent');
            if (!scrollContent) return;

            const pageContainer = document.createElement('div');
            pageContainer.className = 'page-container';
            pageContainer.id = `page-${pageNum}`;
            pageContainer.style.cssText = 'margin-bottom: 30px; text-align: center;';

            const isHighlightPage = highlightPages.includes(pageNum);
            pageContainer.innerHTML = `
                <div class="page-header" style="background: #f7fafc; padding: 10px; margin-bottom: 10px; border-radius: 8px;">
                    <strong>üìÑ ÌéòÏù¥ÏßÄ ${pageNum}</strong>
                    ${isHighlightPage ? ' üé®' : ''}
                </div>
                <div class="loading-spinner" style="margin: 50px auto;"></div>
                <p>ÌéòÏù¥ÏßÄÎ•º Î°úÎî© Ï§ë...</p>
            `;

            if (position === 'top') {
                scrollContent.insertBefore(pageContainer, scrollContent.firstChild);
            } else {
                scrollContent.appendChild(pageContainer);
            }
        }

        // ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô Ìï®Ïàò
        function scrollToPage() {
            const pageNum = prompt('Ïù¥ÎèôÌï† ÌéòÏù¥ÏßÄ Î≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî:', currentVisiblePage);
            if (!pageNum || isNaN(pageNum)) return;

            const targetPage = parseInt(pageNum);
            if (targetPage < 1 || targetPage > currentPDFInfo.total_pages) {
                alert(`1-${currentPDFInfo.total_pages} Î≤îÏúÑÏùò ÌéòÏù¥ÏßÄ Î≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî.`);
                return;
            }

            // ÌéòÏù¥ÏßÄÍ∞Ä ÏóÜÏúºÎ©¥ ÏÉùÏÑ±
            let pageElement = document.getElementById(`page-${targetPage}`);
            if (!pageElement) {
                addPageContainer(targetPage);
                loadPageImage(currentPDFInfo.filename, targetPage);
                pageElement = document.getElementById(`page-${targetPage}`);
            }

            // Ïä§ÌÅ¨Î°§ Ïù¥Îèô
            if (pageElement) {
                pageElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        // ÌéòÏù¥ÏßÄ Îã§Ïãú Î°úÎìú Ìï®Ïàò
        function retryLoadPage(filename, pageNum) {
            const cacheKey = `${filename}-${pageNum}-${currentPDFMode}`;
            preloadedImages.delete(cacheKey); // Ï∫êÏãú ÏÇ≠Ï†ú
            loadPageImage(filename, pageNum);
        }

        // Î™®Îìú Ï†ÑÌôò Ìï®Ïàò (Ïä§ÌÅ¨Î°§ Î≤ÑÏ†Ñ)
        function toggleViewMode() {
            if (!currentPDFInfo) return;

            currentPDFMode = currentPDFMode === 'original' ? 'highlight' : 'original';

            // Ï∫êÏãú ÌÅ¥Î¶¨Ïñ¥ (Î™®ÎìúÍ∞Ä Î∞îÎÄåÏóàÏúºÎØÄÎ°ú)
            preloadedImages.clear();

            // Î∑∞Ïñ¥ Ïû¨ÌëúÏãú
            showScrollPDFViewer(currentPDFInfo.filename, currentVisiblePage);
        }

        // ÌôïÎåÄ/Ï∂ïÏÜå Ìï®ÏàòÎì§ (Ïä§ÌÅ¨Î°§ Î≤ÑÏ†Ñ)
        function zoomInUnified() {
            currentPDFZoom = Math.min(3.0, currentPDFZoom + 0.2);
            updateAllPageZoom();
        }

        function zoomOutUnified() {
            currentPDFZoom = Math.max(0.5, currentPDFZoom - 0.2);
            updateAllPageZoom();
        }

        function toggleZoom() {
            currentPDFZoom = currentPDFZoom === 1.0 ? 1.5 : 1.0;
            updateAllPageZoom();
        }

        function updateAllPageZoom() {
            const images = document.querySelectorAll('#pdfScrollContent img');
            images.forEach(img => {
                img.style.transform = `scale(${currentPDFZoom})`;
            });
        }

        // ÌÜµÌï© Î∑∞Ïñ¥ ÌëúÏãú Ìï®Ïàò (Í∏∞Ï°¥ - ÏÇ≠Ï†ú ÏòàÏ†ï)
        function showUnifiedViewer(filename, targetPage) {
            const viewerContent = document.getElementById('viewerContent');
            const totalPages = currentPDFInfo.total_pages;

            // Î™®ÎìúÎ≥Ñ Ï†úÎ™©
            const modeInfo = currentPDFMode === 'highlight'
                ? `üé® ÌïòÏù¥ÎùºÏù¥Ìä∏: "${currentHighlightKeyword}"`
                : 'üìÑ ÏõêÎ≥∏ PDF';

            viewerContent.innerHTML = `
                <div class="unified-viewer-toolbar">
                    <button onclick="closePDFViewer()">‚úñ Îã´Í∏∞</button>
                    <button onclick="toggleViewMode()" title="Î≥¥Í∏∞ Î™®Îìú Ï†ÑÌôò">
                        ${currentPDFMode === 'original' ? 'üé® ÌïòÏù¥ÎùºÏù¥Ìä∏' : 'üìÑ ÏõêÎ≥∏'}
                    </button>
                    <button onclick="zoomInUnified()">üîç+ ÌôïÎåÄ</button>
                    <button onclick="zoomOutUnified()">üîç- Ï∂ïÏÜå</button>
                    <button onclick="openPDFInNewTab('${filename}', ${targetPage})">üîó ÏÉà ÌÉ≠</button>
                    <div class="viewer-info">${modeInfo} - ${filename}</div>
                </div>

                <div class="unified-pdf-container" style="height: calc(100% - 60px); background: #ffffff; overflow-y: auto;">
                    <div class="page-navigation" style="position: sticky; top: 0; background: #ffffff; padding: 10px; border-bottom: 1px solid #e2e8f0; z-index: 10;">
                        <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                            <button onclick="goToPage(${Math.max(1, targetPage - 1)})" ${targetPage <= 1 ? 'disabled' : ''}>‚óÄ Ïù¥Ï†Ñ</button>
                            <span>ÌéòÏù¥ÏßÄ ${targetPage} / ${totalPages}</span>
                            <button onclick="goToPage(${Math.min(totalPages, targetPage + 1)})" ${targetPage >= totalPages ? 'disabled' : ''}>Îã§Ïùå ‚ñ∂</button>
                        </div>
                    </div>

                    <div id="pdfPageContent" style="text-align: center; padding: 20px;">
                        <div class="loading-spinner" style="margin: 50px auto;"></div>
                        <p>ÌéòÏù¥ÏßÄÎ•º Î°úÎî© Ï§ë...</p>
                    </div>
                </div>
            `;

            // ÌéòÏù¥ÏßÄ Î°úÎìú
            loadPDFPage(filename, targetPage);
        }

        // PDF ÌéòÏù¥ÏßÄ Î°úÎìú Ìï®Ïàò
        async function loadPDFPage(filename, page) {
            const pageContent = document.getElementById('pdfPageContent');
            const encodedFilename = encodeURIComponent(filename);

            try {
                let imageUrl;
                if (currentPDFMode === 'highlight' && currentHighlightKeyword) {
                    imageUrl = `${API_BASE_URL}/api/pdf-highlight/${encodedFilename}/${page}/${encodeURIComponent(currentHighlightKeyword)}`;
                } else {
                    imageUrl = `${API_BASE_URL}/api/pdf-page-image/${encodedFilename}/${page}`;
                }

                const img = new Image();
                img.onload = () => {
                    pageContent.innerHTML = `
                        <img id="currentPageImage"
                             src="${imageUrl}"
                             alt="PDF ÌéòÏù¥ÏßÄ ${page}"
                             style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); background: #ffffff; transform: scale(${currentPDFZoom});"
                             onclick="toggleZoom()">
                        ${currentPDFMode === 'highlight' ?
                            `<p style="margin-top: 15px; color: #718096; font-size: 0.9rem;">
                                üí° "${currentHighlightKeyword}" ÌÇ§ÏõåÎìúÍ∞Ä ÎÖ∏ÎûÄÏÉâÏúºÎ°ú ÌïòÏù¥ÎùºÏù¥Ìä∏Îê©ÎãàÎã§
                            </p>` : ''}
                    `;
                };

                img.onerror = () => {
                    pageContent.innerHTML = `
                        <div style="padding: 40px; color: #e53e3e;">
                            <div style="font-size: 3rem; margin-bottom: 20px;">‚ö†Ô∏è</div>
                            <h3>ÌéòÏù¥ÏßÄ Î°úÎìú Ïã§Ìå®</h3>
                            <p>ÌéòÏù¥ÏßÄ ${page}Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.</p>
                            <button onclick="loadPDFPage('${filename}', ${page})" style="margin-top: 15px; padding: 8px 16px; background: #4fd1c7; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                üîÑ Îã§Ïãú ÏãúÎèÑ
                            </button>
                        </div>
                    `;
                };

                img.src = imageUrl;

            } catch (error) {
                console.error('ÌéòÏù¥ÏßÄ Î°úÎìú Ïò§Î•ò:', error);
                pageContent.innerHTML = `
                    <div style="padding: 40px; color: #e53e3e;">
                        <h3>Î°úÎìú Ïò§Î•ò</h3>
                        <p>ÌéòÏù¥ÏßÄ Î°úÎìú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.</p>
                    </div>
                `;
            }
        }

        // ÌéòÏù¥ÏßÄ Ïù¥Îèô Ìï®Ïàò
        function goToPage(page) {
            if (!currentPDFInfo || page < 1 || page > currentPDFInfo.total_pages) return;

            loadPDFPage(currentPDFInfo.filename, page);

            // ÎÇ¥ÎπÑÍ≤åÏù¥ÏÖò ÏóÖÎç∞Ïù¥Ìä∏
            const navigation = document.querySelector('.page-navigation div');
            if (navigation) {
                navigation.innerHTML = `
                    <button onclick="goToPage(${Math.max(1, page - 1)})" ${page <= 1 ? 'disabled' : ''}>‚óÄ Ïù¥Ï†Ñ</button>
                    <span>ÌéòÏù¥ÏßÄ ${page} / ${currentPDFInfo.total_pages}</span>
                    <button onclick="goToPage(${Math.min(currentPDFInfo.total_pages, page + 1)})" ${page >= currentPDFInfo.total_pages ? 'disabled' : ''}>Îã§Ïùå ‚ñ∂</button>
                `;
            }
        }

        // Î≥¥Í∏∞ Î™®Îìú Ï†ÑÌôò
        function toggleViewMode() {
            if (!currentPDFInfo) return;

            currentPDFMode = currentPDFMode === 'original' ? 'highlight' : 'original';

            // ÌòÑÏû¨ ÌéòÏù¥ÏßÄ Î≤àÌò∏ Ïú†ÏßÄ
            const currentPageMatch = document.querySelector('.page-navigation span')?.textContent.match(/ÌéòÏù¥ÏßÄ (\d+)/);
            const currentPage = currentPageMatch ? parseInt(currentPageMatch[1]) : 1;

            showUnifiedViewer(currentPDFInfo.filename, currentPage);
        }

        // ÌôïÎåÄ/Ï∂ïÏÜå Ìï®Ïàò
        function zoomInUnified() {
            currentPDFZoom = Math.min(3.0, currentPDFZoom + 0.2);
            const img = document.getElementById('currentPageImage');
            if (img) {
                img.style.transform = `scale(${currentPDFZoom})`;
            }
        }

        function zoomOutUnified() {
            currentPDFZoom = Math.max(0.5, currentPDFZoom - 0.2);
            const img = document.getElementById('currentPageImage');
            if (img) {
                img.style.transform = `scale(${currentPDFZoom})`;
            }
        }

        // Ïù¥ÎØ∏ÏßÄ ÌÅ¥Î¶≠ÏúºÎ°ú Ï§å ÌÜ†Í∏Ä
        function toggleZoom() {
            currentPDFZoom = currentPDFZoom === 1.0 ? 1.5 : 1.0;
            const img = document.getElementById('currentPageImage');
            if (img) {
                img.style.transform = `scale(${currentPDFZoom})`;
            }
        }

        // Ïù¥ÎØ∏ÏßÄ ÏÉà ÌÉ≠ÏóêÏÑú Ïó¥Í∏∞ Ìï®Ïàò
        function openImageInNewTab(imageSrc) {
            const newWindow = window.open('', '_blank');
            newWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>PDF ÏõêÎ≥∏ Ïù¥ÎØ∏ÏßÄ</title>
                    <style>
                        body {
                            margin: 0;
                            padding: 20px;
                            background: #f5f5f5;
                            display: flex;
                            justify-content: center;
                            align-items: center;
                            min-height: 100vh;
                            font-family: Arial, sans-serif;
                        }
                        img {
                            max-width: 95%;
                            max-height: 95vh;
                            border: 2px solid #ddd;
                            border-radius: 8px;
                            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
                            background: white;
                        }
                        .toolbar {
                            position: fixed;
                            top: 10px;
                            right: 10px;
                            background: rgba(0,0,0,0.8);
                            padding: 10px;
                            border-radius: 8px;
                            color: white;
                            font-size: 14px;
                        }
                    </style>
                </head>
                <body>
                    <div class="toolbar">
                        üí° ÎßàÏö∞Ïä§ Ìú†Î°ú ÌôïÎåÄ/Ï∂ïÏÜå Í∞ÄÎä•
                    </div>
                    <img src="${imageSrc}" alt="PDF ÏõêÎ≥∏ Ïù¥ÎØ∏ÏßÄ" ondblclick="this.style.transform = this.style.transform ? '' : 'scale(1.5)'">
                </body>
                </html>
            `);
            newWindow.document.close();
        }

        // Ïã§ÏãúÍ∞Ñ Í≤ÄÏÉâ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
        document.getElementById('searchInput').addEventListener('input', handleRealTimeSearch);

        // Enter ÌÇ§Î°ú Ï¶âÏãú Í≤ÄÏÉâ
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                clearTimeout(searchTimeout); // ÌÉÄÏù¥Î®∏ Ï∑®ÏÜåÌïòÍ≥† Ï¶âÏãú Í≤ÄÏÉâ
                performSearch();
            }
        });

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú FastAPI ÏÑúÎ≤Ñ ÏÉÅÌÉú ÌôïÏù∏ (Ïû¨ÏãúÎèÑ Î°úÏßÅ Ï∂îÍ∞Ä)
        window.addEventListener('load', function() {
            const maxRetries = 5;
            let attempt = 0;
            const resultsDiv = document.getElementById('results');

            function checkServerStatus() {
                // Ï¥àÍ∏∞ÏóêÎßå Î©îÏãúÏßÄ ÌëúÏãú
                if (attempt === 0) {
                     resultsDiv.innerHTML = `
                        <div class="error-message" style="background-color: rgba(59, 130, 246, 0.1); color: #93c5fd; border-color: rgba(59, 130, 246, 0.2);">
                            ‚è≥ Í≤ÄÏÉâ ÏÑúÎ≤ÑÏóê Ïó∞Í≤∞ Ï§ë...
                        </div>
                    `;
                }

                fetch(`${API_BASE_URL}/health`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`Server returned status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        resultsDiv.innerHTML = `
                             <div class="error-message" style="background-color: rgba(16, 185, 129, 0.1); color: #6ee7b7; border-color: rgba(16, 185, 129, 0.2);">
                                ‚úÖ Í≤ÄÏÉâ ÏÑúÎ≤ÑÏóê ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ïó∞Í≤∞ÎêòÏóàÏäµÎãàÎã§.
                            </div>
                        `;
                        // 2Ï¥à ÌõÑÏóê Î©îÏãúÏßÄ ÏßÄÏö∞Í∏∞
                        setTimeout(() => {
                           if (resultsDiv.querySelector('.error-message')) {
                                resultsDiv.innerHTML = '';
                           }
                        }, 2000);
                    })
                    .catch(error => {
                        attempt++;

                        if (attempt < maxRetries) {
                            const delay = Math.pow(2, attempt) * 1000; // 2, 4, 8, 16Ï¥à
                             resultsDiv.innerHTML = `
                                <div class="error-message" style="background-color: rgba(245, 158, 11, 0.1); color: #fcd34d; border-color: rgba(245, 158, 11, 0.2);">
                                    ‚è≥ Í≤ÄÏÉâ ÏÑúÎ≤Ñ Ïó∞Í≤∞ Ïû¨ÏãúÎèÑ Ï§ë... (${attempt}/${maxRetries})<br>
                                    ÏÑúÎ≤Ñ ÏãúÏûëÏùÑ Í∏∞Îã§Î¶¨Í≥† ÏûàÏäµÎãàÎã§. ÏïΩ ${delay/1000}Ï¥à ÌõÑ Îã§Ïãú ÏãúÎèÑÌï©ÎãàÎã§.
                                </div>
                            `;
                            setTimeout(checkServerStatus, delay);
                        } else {
                            resultsDiv.innerHTML = `
                                <div class="error-message">
                                    ‚ùå Í≤ÄÏÉâ ÏÑúÎ≤ÑÏóê Ïó∞Í≤∞Ìï† Ïàò ÏóÜÏäµÎãàÎã§.<br>
                                    FastAPI ÏÑúÎ≤Ñ(${API_BASE_URL})Í∞Ä Ïã§Ìñâ Ï§ëÏù∏ÏßÄ, Î∞©ÌôîÎ≤ΩÏóê ÏùòÌï¥ Ï∞®Îã®ÎêòÏßÄ ÏïäÏïòÎäîÏßÄ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.
                                </div>
                            `;
                        }
                    });
            }

            checkServerStatus();
        });
    </script>
</body>
</html>